<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Plugins</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='https://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Plugins </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#plugins_a">Generating a CMake project</a></li>
<li class="level1"><a href="#customPlugins_b">Plugin interface</a></li>
<li class="level1"><a href="#plugins_c">Fully custom plugins</a></li>
</ul>
</div>
<div class="textblock"><p>Many systems in bs::f are implemented through plugins, libraries that are separate from the core of the engine and can be dynamically loaded or unloaded. If possible, it is the prefered way of extending the engine.</p>
<p>bs::f supports plugins for the following systems:</p><ul>
<li>Audio - Systems for providing audio playback.</li>
<li>Importers - Importers that handle conversion of some third party resource format into an engine-ready format.</li>
<li>Physics - Runs the physics simulation.</li>
<li>Renderer - Determines how is the scene displayed (lighting, shadows, post-processing, etc.).</li>
<li>Rendering backend - Wrappers for render APIs like DirectX, OpenGL or Vulkan.</li>
</ul>
<p>You can choose which plugins are loaded on <b>Application</b> start-up, by filling out the <a class="el" href="structbs_1_1_s_t_a_r_t___u_p___d_e_s_c.html">START_UP_DESC</a> structure.</p>
<div class="fragment"><div class="line">START_UP_DESC startUpDesc;</div><div class="line"></div><div class="line"><span class="comment">// Required plugins</span></div><div class="line">startUpDesc.renderAPI = <span class="stringliteral">&quot;bsfD3D11RenderAPI&quot;</span>;</div><div class="line">startUpDesc.renderer = <span class="stringliteral">&quot;bsfRenderBeast&quot;</span>;</div><div class="line">startUpDesc.audio = <span class="stringliteral">&quot;bsfOpenAudio&quot;</span>;</div><div class="line">startUpDesc.physics = <span class="stringliteral">&quot;bsfPhysX&quot;</span>;</div><div class="line">startUpDesc.input = <span class="stringliteral">&quot;bsfOISInput&quot;</span>;</div><div class="line"></div><div class="line"><span class="comment">// List of importer plugins we plan on using for importing various resources</span></div><div class="line">startUpDesc.importers.push_back(<span class="stringliteral">&quot;bsfFreeImgImporter&quot;</span>); <span class="comment">// For importing textures</span></div><div class="line">startUpDesc.importers.push_back(<span class="stringliteral">&quot;bsfFBXImporter&quot;</span>); <span class="comment">// For importing meshes</span></div><div class="line">startUpDesc.importers.push_back(<span class="stringliteral">&quot;bsfFontImporter&quot;</span>); <span class="comment">// For importing fonts</span></div><div class="line">startUpDesc.importers.push_back(<span class="stringliteral">&quot;bsfSL&quot;</span>); <span class="comment">// For importing shaders</span></div><div class="line"></div><div class="line"><span class="comment">// ... also set up primary window in startUpDesc ...</span></div><div class="line"></div><div class="line">Application::startUp(startUpDesc);</div><div class="line"></div><div class="line"><span class="comment">// ... create scene, run main loop, shutdown</span></div></div><!-- fragment --><p>In this manual we'll focus on general functionality common to all plugins, while we'll talk about how to implement plugins for specific systems in later manuals.</p>
<h1><a class="anchor" id="plugins_a"></a>
Generating a CMake project</h1>
<p>Plugins are always created as their own projects/libraries. bs::f uses the CMake build system for managing its projects. Therefore the first step you need to take is to create your own CMake project. This involves creating a new folder in the /Source/Plugins directory (e.g. Source/Plugins/MyPlugin), with a CMakeLists.txt file inside it. CMakeLists.txt will contain references to needed header &amp; source files, as well as dependencies to any other libraries.</p>
<p>An example CMakeLists.txt might look like so: </p><div class="fragment"><div class="line"># Source files</div><div class="line">set(SOURCE_FILES</div><div class="line">    &quot;Include/MyHeader.h&quot;</div><div class="line">    &quot;Source/MyPlugin.cpp&quot;   </div><div class="line">)</div><div class="line"></div><div class="line"># Target</div><div class="line">## Registers our plugin a specific name (MyPlugin) and with the relevant source files</div><div class="line">add_library(MyPlugin SHARED ${SOURCE_FILES})</div><div class="line"></div><div class="line"># Include directories</div><div class="line">## Including just the current folder</div><div class="line">target_include_directories(MyPlugin PRIVATE &quot;./&quot;)</div><div class="line"></div><div class="line"># Libraries</div><div class="line">## Link with bsf</div><div class="line">target_link_libraries(MyPlugin PUBLIC bsf)</div></div><!-- fragment --><p>Note that we won't go into details about CMake syntax, it's complex and there are many other guides already written on it.</p>
<p>After creating your project's CMake file, you need to register it with the main CMakeLists.txt present in the /Source directory. Simply append the following line: </p><div class="fragment"><div class="line"># Provided your plugin is located in Source/Plugins/MyPlugin folder</div><div class="line">add_subdirectory(Plugins/MyPlugin)</div></div><!-- fragment --><h1><a class="anchor" id="customPlugins_b"></a>
Plugin interface</h1>
<p>If you wish to create a plugin for any of the systems listed above, you will need to implement an informal interface through global "extern" methods. The interface supports three functions:</p><ul>
<li><b>loadPlugin()</b> - Called when the plugin is initially loaded</li>
<li><b>updatePlugin()</b> - Called every frame</li>
<li><b>unloadPlugin()</b> - Called just before the plugin is unloaded</li>
</ul>
<p>You may choose to implement some, or none of these, although usually at least <b>loadPlugin()</b> method is needed so the plugin can register itself with the necessary system. </p><div class="fragment"><div class="line"><span class="keyword">class </span>MyPlugin : Module&lt;MyPlugin&gt;</div><div class="line">{</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> BS_MYPLUGIN_EXPORT <span class="keywordtype">void</span>* loadPlugin()</div><div class="line">{</div><div class="line">    MyPlugin::startUp();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>; <span class="comment">// Not used</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> BS_MYPLUGIN_EXPORT <span class="keywordtype">void</span> updatePlugin()</div><div class="line">{</div><div class="line">    <span class="comment">// Do something every frame</span></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> BS_MYPLUGIN_EXPORT <span class="keywordtype">void</span> unloadPlugin()</div><div class="line">{</div><div class="line">    MyPlugin::shutDown();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// BS_MYPLUGIN_EXPORT is a macro for a compiler-specific export attribute</span></div><div class="line"><span class="comment">// (e.g. __declspec(dllexport) for Visual Studio (MSVC))</span></div></div><!-- fragment --><p>After you have your plugin interface, all you need to do is to pass the name of your plugin (as defined in CMake) to one of the entries in <b>START_UP_DESC</b> for it to be loaded.</p>
<blockquote class="doxtable">
<p>It's important that all objects created by the plugin are deleted before plugin unload happens. If this doesn't happen, and an object instance is deleted after the plugin has been unloaded you will end up with a corrupt virtual function table and a crash. </p>
</blockquote>
<h1><a class="anchor" id="plugins_c"></a>
Fully custom plugins</h1>
<p>You can also create a fully customized plugin that doesn't implement functionality for any existing engine system. The engine has no interface expectations for such plugins, and it's up to you to manually load/unload them, as well as to manually call their functions.</p>
<p>To load a custom plugin you can use:</p><ul>
<li><a class="el" href="classbs_1_1_core_application.html#ac568b9e60e891b97a0b60a8876a88c12">Application::loadPlugin()</a> - Accepts the name of the plugin library and outputs the library object. Optionally you may also pass a parameter to the <b>loadPlugin</b> method, if your plugin defines one.</li>
<li><a class="el" href="classbs_1_1_core_application.html#a249e6a53073d18052bb0ff621b4689f2">Application::unloadPlugin()</a> - Unloads a previously loaded plugin.</li>
</ul>
<div class="fragment"><div class="line">DynLib* pluginLib;</div><div class="line"><a class="code" href="group___application-_engine.html#gac5ac20960426d36154b4e1dc3da22400">gApplication</a>()::loadPlugin(<span class="stringliteral">&quot;MyPlugin&quot;</span>, &amp;pluginLib);</div><div class="line"><span class="comment">// Do something</span></div><div class="line"><a class="code" href="group___application-_engine.html#gac5ac20960426d36154b4e1dc3da22400">gApplication</a>()::unloadPlugin(pluginLib);</div></div><!-- fragment --><p>Both of those methods internally call <b>DynLibManager</b> which we described earlier. In fact you can also use it directly for loading plugins, as an alternative to this approach.</p>
<p>Once the library is loaded you can use the <a class="el" href="classbs_1_1_dyn_lib.html">DynLib</a> object, and its <a class="el" href="classbs_1_1_dyn_lib.html#a1098412880f990a8539f302bf0eac591">DynLib::getSymbol()</a> method to retrieve a function pointer within the dynamic library, and call into it. </p><div class="fragment"><div class="line"><span class="comment">// Retrieve function pointer (symbol)</span></div><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">void</span>* (*LoadPluginFunc)();</div><div class="line">LoadPluginFunc loadPluginFunc = (LoadPluginFunc)pluginLib-&gt;getSymbol(<span class="stringliteral">&quot;loadPlugin&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// Call the function</span></div><div class="line">loadPluginFunc();</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
