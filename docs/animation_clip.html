<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Loading animation clips</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='http://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="../SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="../SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Loading animation clips </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#animationClip_a">Import</a></li>
<li class="level1"><a href="#animationClip_b">Animation properties</a></li>
<li class="level1"><a href="#animationClip_c">Advanced</a><ul><li class="level2"><a href="#animationClip_c_a">Splitting</a></li>
<li class="level2"><a href="#animationClip_c_b">Keyframe reduction</a></li>
<li class="level2"><a href="#animationClip_c_c">Animation events</a></li>
<li class="level2"><a href="#animationClip_c_d">Root motion</a></li>
<li class="level2"><a href="#animationClip_c_e">Additive animation</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>When it comes to animating 3D objects (meshes), bs::f supports two types of animation:</p><ul>
<li>Skeletal - Each vertex on the mesh is assigned to a bone using an index and a weight - this is called a skin. Each bone is part of a hierarchy which is called a skeleton. The bones are then animated using animation clips, and as the bones move, so do the vertices (skin) attached to them.</li>
<li>Morph - Many different versions of the same mesh exist, representing different shapes of the mesh. By interpolating between the shapes animation is produced. This interpolation is also controlled by animation clips.</li>
</ul>
<p>In general it is preferred to use skeletal animation wherever possible, as it has lower memory requirements, allows interesting ways to combine animations and allows other objects to be attached to bones (as we'll show later). Morph animation is preferable for complex animations where bones just don't cut it (e.g. facial animation can sometimes benefit, as well as objects that have very soft structure without a clear way to set up the skeleton).</p>
<p>TODO_IMAGE_SKELETAL_ANIM</p>
<p>TODO_IMAGE_MORPH_ANIM</p>
<p>Both animation types are controlled via <a class="el" href="classbs_1_1_animation_clip.html">AnimationClip</a>s.</p>
<p>Animation clip consists of a set of animation curves, each animating either a bone or a set of morph shapes. Each animation curve has a set of keyframes (time and value pairs). As animation is playing, time moves forward and the system interpolates between those keyframes and applies the latest available value, which produces the animation. Knowledge of this internal structure is not necessary to play animation, but it will be useful to know when we explain some more advanced features below.</p>
<h1><a class="anchor" id="animationClip_a"></a>
Import</h1>
<p>Animation clips are imported from the same source file that contains the mesh object. The import process is similar to how we imported physics meshes, using <b>Importer::importAll()</b> to retrieve the clips.</p>
<p>To enable animation clip import you must set <a class="el" href="classbs_1_1_mesh_import_options.html#a6f3b766f7386f1ecedd4c41fcdd09a0b">MeshImportOptions::setImportAnimation()</a> to true, import the mesh and retrieve the clip from the resulting resource array. Note that a source file could contain multiple animation clips (depending on how it was created).</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> importOptions = MeshImportOptions::create();</div><div class="line">importOptions-&gt;setImportAnimation(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="keyword">auto</span> resources = <a class="code" href="group___importer.html#gafda9808bfcae11afa60eee731056225e">gImporter</a>().<a class="code" href="classbs_1_1_importer.html#a6e6a5c8e1bdcd95f6924c90fc642074e">importAll</a>(<span class="stringliteral">&quot;humanAnimated.fbx&quot;</span>, importOptions);</div><div class="line">HAnimationClip animationClip = <a class="code" href="group___resources.html#gaf38f08e12f1845752a5aeb1b268851f3">static_resource_cast</a>&lt;AnimationClip&gt;(resources[1].value);</div></div><!-- fragment --><p>We'll show how to use animation clips in the following chapter, while in this one we'll just focus on importing them.</p>
<p>Aside from the animation clip you will also need to import additional data for the mesh itself. Depending on whether you're using skeletal or morph animation (or both), you need to enable <a class="el" href="classbs_1_1_mesh_import_options.html#a8038f2a235bc739de0727108332df5ec">MeshImportOptions::setImportSkin()</a> and/or <a class="el" href="classbs_1_1_mesh_import_options.html#a27c10222cc6f5cd89183ae9f8516d133">MeshImportOptions::setImportBlendShapes()</a>. This will import required additional per-vertex information, skeleton &amp; bone information, as well as morph shapes.</p>
<div class="fragment"><div class="line">importOptions-&gt;setImportSkin(<span class="keyword">true</span>); <span class="comment">// For skeletal animation</span></div><div class="line">importOptions-&gt;setImportBlendShapes(<span class="keyword">true</span>); <span class="comment">// For morph shapes</span></div></div><!-- fragment --><blockquote class="doxtable">
<p>These options add additional information to <b>Mesh</b>, accessible through <a class="el" href="classbs_1_1_mesh.html#aeac87086b7a6f7bb5a6d7fbc792f7732">Mesh::getSkeleton()</a> and <a class="el" href="classbs_1_1_mesh.html#a8c9ef8c08fe669770f69a9f59eb0e5ce">Mesh::getMorphShapes()</a>. This information will automatically be used by the animation system (you don't need to do anything but enable these flags on import), but can be accessed by the user if required for some special purpose. </p>
</blockquote>
<h1><a class="anchor" id="animationClip_b"></a>
Animation properties</h1>
<p>Once imported the animation clip provides a few properties you can query. Use <a class="el" href="classbs_1_1_animation_clip.html#a7330762d82cdba87643bb5f91a331294">AnimationClip::getLength()</a> to get the duration of the animation in seconds. Use <a class="el" href="classbs_1_1_animation_clip.html#a28238d7491457f9cce47824b96aab680">AnimationClip::getCurves()</a> to retrieve all animation curves that are a part of the animation.</p>
<p>These aren't properties you need to access manually for normal animation playback, but it can be useful to know they're there. You can also manually assign custom animation curves by calling <a class="el" href="classbs_1_1_animation_clip.html#a7d08226d8531119e638b60b4a9a096cb">AnimationClip::setCurves()</a>. This allows you to create fully customized animations within the engine. Creation of animation curves is out of the scope of this manual but you can look up documentation for <a class="el" href="structbs_1_1_animation_curves.html">AnimationCurves</a> and related classes for more information.</p>
<h1><a class="anchor" id="animationClip_c"></a>
Advanced</h1>
<h2><a class="anchor" id="animationClip_c_a"></a>
Splitting</h2>
<p>Often the creator of the animation will place several animations into the same set of animation curves, one playing after another. When imported in bs::f this will result in a single continous animation clip. This is not useful and in such cases you can break up the animation into multiple clips by populating a set of <a class="el" href="structbs_1_1_animation_split_info.html">AnimationSplitInfo</a> structures, and providing them to <a class="el" href="classbs_1_1_mesh_import_options.html#aa3ed91c1e5a99f3d558102384e202cdb">MeshImportOptions::setAnimationClipSplits()</a>.</p>
<p>Each of <b>AnimationSplitInfo</b> entries requires the starting and ending frame of the animation, as well as a name to make it easier to identify. Starting/ending frames are something you must receive from the animation creator, or guess from animation playback.</p>
<div class="fragment"><div class="line">Vector&lt;AnimationSplitInfo&gt; splitInfos(3);</div><div class="line">splitInfos[0].name = <span class="stringliteral">&quot;Walk&quot;</span>;</div><div class="line">splitInfos[0].startFrame = 0;</div><div class="line">splitInfos[0].endFrame = 120;</div><div class="line"></div><div class="line">splitInfos[1].name = <span class="stringliteral">&quot;Run&quot;</span>;</div><div class="line">splitInfos[1].startFrame = 120;</div><div class="line">splitInfos[1].endFrame = 240;</div><div class="line"></div><div class="line">splitInfos[2].name = <span class="stringliteral">&quot;Wave&quot;</span>;</div><div class="line">splitInfos[2].startFrame = 240;</div><div class="line">splitInfos[2].endFrame = 300;</div><div class="line"></div><div class="line">importOptions-&gt;setAnimationClipSplits(splitInfos);</div><div class="line"><span class="keyword">auto</span> resources = <a class="code" href="group___importer.html#gafda9808bfcae11afa60eee731056225e">gImporter</a>().<a class="code" href="classbs_1_1_importer.html#a6e6a5c8e1bdcd95f6924c90fc642074e">importAll</a>(<span class="stringliteral">&quot;humanAnimated.fbx&quot;</span>, importOptions);</div><div class="line"></div><div class="line">HAnimationClip walkClip, runClip, waveClip;</div><div class="line"><span class="keywordflow">for</span>(<span class="keyword">auto</span>&amp; entry : resource)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span>(entry.name == <span class="stringliteral">&quot;Walk&quot;</span>)</div><div class="line">        walkClip = entry.value;</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(entry.name == <span class="stringliteral">&quot;Run&quot;</span>)</div><div class="line">        runClip = entry.value;</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(entry.name == <span class="stringliteral">&quot;Wave&quot;</span>)</div><div class="line">        waveClip = entry.value;</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="animationClip_c_b"></a>
Keyframe reduction</h2>
<p>Tools that create animation will often output a large set of animation keyframes, usually at a fixed rate (e.g. 60 per second). In most cases this amount of keyframes is not necessary as many of them are static and change very slowly. Additionally bs::f uses keyframe tangents to better approximate the animation curve, ensuring less keyframes need to be used.</p>
<p>By enabling <a class="el" href="classbs_1_1_mesh_import_options.html#ac51e96b2bf45257d58856c9eda3a3a5e">MeshImportOptions::setKeyFrameReduction()</a> you can ensure that bs::f eliminates any keyframes it deems unnecessary. This can greately reduce the memory usage of animation clips, but might yield animation clips that don't look exactly as imagined by the creator. In most cases you should enable this unless you notice problems.</p>
<div class="fragment"><div class="line">importOptions-&gt;setKeyFrameReduction(<span class="keyword">true</span>);</div></div><!-- fragment --><h2><a class="anchor" id="animationClip_c_c"></a>
Animation events</h2>
<p>Often while animation is playing you might want to be notified when a certain point in an animation is reached. For example in a walk animation we might want a notification when the character's foot touches the ground, so we can play the footstep sound. These kind of notifications can be accomplished by using animation events.</p>
<p>They are extremely simple, represented by <a class="el" href="structbs_1_1_animation_event.html">AnimationEvent</a> structure, which consists of a name and a time. You can register animation events by calling <a class="el" href="classbs_1_1_animation_clip.html#ab82778acdbbf57b59f79e2a5bf32ef9c">AnimationClip::setEvents()</a>.</p>
<div class="fragment"><div class="line">Vector&lt;AnimationEvent&gt; events(2);</div><div class="line">events[0].name = <span class="stringliteral">&quot;FootstepLeft&quot;</span>;</div><div class="line">events[0].time = 0.5f;</div><div class="line">events[1].name = <span class="stringliteral">&quot;FootstepRight&quot;</span>;</div><div class="line">events[1].time = 1.5f;</div><div class="line"></div><div class="line">walkClip-&gt;setEvents(events);</div></div><!-- fragment --><p>We'll show how to receive event notifications in the following chapter.</p>
<h2><a class="anchor" id="animationClip_c_d"></a>
Root motion</h2>
<p>Root motion represents an animation curve used for movement of the root bone in skeletal animation. This animation curve is useful for characters and objects that are animated and also move through the world in a dynamic way (like a user controller character or an AI controlled entity).</p>
<p>By enabling root motion you ensure that the animation clip's root motion curve is removed, and you instead get access to the relevant curve directly. You can then use this curve to move the entity through the world. This results in motion that is more realistic and more in line with the animation, than if you just moved the entity in some linear fashion (e.g. a walking character would appear to be gliding, rather than actually walking, since humans and animals don't move at a constant pace).</p>
<p>Enable root motion import by calling <a class="el" href="classbs_1_1_mesh_import_options.html#aef99480b5d8e58d142ddf9c57708ba81">MeshImportOptions::setImportRootMotion()</a>. Then retrieve the root motion curve through <a class="el" href="classbs_1_1_animation_clip.html#ad835a6fcc9d52dfda21aac8262496682">AnimationClip::getRootMotion()</a>. This will return a <a class="el" href="structbs_1_1_root_motion.html">RootMotion</a> object, which contains two animation curves, one for rotation, other for translation.</p>
<p>Animation curves are represented through the <a class="el" href="classbs_1_1_t_animation_curve.html">TAnimationCurve&lt;T&gt;</a> object. You can evaluate the curve by calling <a class="el" href="classbs_1_1_t_animation_curve.html#a3c9ec1d068f7ac732d479e93fb8bb8b4">TAnimationCurve&lt;T&gt;::evaluate()</a> with a specific time value.</p>
<div class="fragment"><div class="line"><span class="comment">// Import animation with root motion</span></div><div class="line">importOptions-&gt;setImportRootMotion(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="keyword">auto</span> resources = <a class="code" href="group___importer.html#gafda9808bfcae11afa60eee731056225e">gImporter</a>().<a class="code" href="classbs_1_1_importer.html#a6e6a5c8e1bdcd95f6924c90fc642074e">importAll</a>(<span class="stringliteral">&quot;humanAnimated.fbx&quot;</span>, importOptions);</div><div class="line">HAnimationClip animationClip = <a class="code" href="group___resources.html#gaf38f08e12f1845752a5aeb1b268851f3">static_resource_cast</a>&lt;AnimationClip&gt;(resources[1].value);</div><div class="line"></div><div class="line">SPtr&lt;RootMotion&gt; rootMotion = animationClip-&gt;getRootMotion();</div><div class="line"></div><div class="line"><span class="comment">// Move a character using root motion</span></div><div class="line">Vector3 characterPosition(BsZero);</div><div class="line"></div><div class="line"><span class="comment">// Get initial root translation</span></div><div class="line">Vector3 lastRootMotion = rootMotion-&gt;translation-&gt;evaluate(0.0f);</div><div class="line"><span class="keywordtype">float</span> time = 0.0f;</div><div class="line"></div><div class="line"><span class="comment">// While W key is pressed move character forward</span></div><div class="line"><span class="keywordflow">if</span>(<a class="code" href="group___input.html#ga0a3fe5b5d0b802f8321e47000df19318">gInput</a>().isButtonHeld(BC_W))</div><div class="line">{</div><div class="line">    <span class="comment">// Find out how much the animation changed between this and previous frame</span></div><div class="line">    Vector3 curRootMotion = rootMotion-&gt;translation-&gt;evaluate(time);</div><div class="line">    Vector3 movementDiff = curRootMotion - lastRootMotion;</div><div class="line"></div><div class="line">    <span class="comment">// Apply that change to actual movement</span></div><div class="line">    characterPosition += movementDiff;</div><div class="line"></div><div class="line">    time += <a class="code" href="group___general.html#ga87bc3999f37b96ff9dfb50c554e38827">gTime</a>().frameDelta();</div><div class="line">    lastRootMotion = curRootMotion;</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="animationClip_c_e"></a>
Additive animation</h2>
<p>Additive animation is a special type of skeletal animation that is not meant to be played on its own. Instead it is animation that is meant to be played on top of another animation clip. For example if you had a walk/run/crawl animation for your character, and then wanted to add a wave animation to the game. Instead of creating separate versions of walk/run/crawl animations, you can instead create an additive wave animation. Such additive animation can then play on top of any other compatible animations, without having to modify any existing animations.</p>
<p>Note that artist creating such animation needs to pay attention to two things:</p><ul>
<li>Bones not part of the additive animation should not have any animation curves, or if they do they should all have the same value.</li>
<li>All animation curves animating the bone should have the same or similar 0th keyframe. This keyframe is used as a baseline and if they're too different added animations can make final animation look weird.</li>
</ul>
<p>Additive animations can only be enabled through <b>AnimationSplitInfo</b> info, by setting <b>AnimationSplitInfo::isAdditive</b> to true.</p>
<div class="fragment"><div class="line">Vector&lt;AnimationSplitInfo&gt; splitInfo(1);</div><div class="line">splitInfo[0].name = <span class="stringliteral">&quot;Walk&quot;</span>;</div><div class="line">splitInfo[0].startFrame = 0;</div><div class="line">splitInfo[0].endFrame = 120;</div><div class="line">splitInfo[0].isAdditive = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">importOptions-&gt;setAnimationClipSplits(splitInfo);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
