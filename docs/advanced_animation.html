<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Advanced animation</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='https://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Advanced animation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#advancedAnimation_a">Cross fade</a></li>
<li class="level1"><a href="#advancedAnimation_b">Sampling</a></li>
<li class="level1"><a href="#advancedAnimation_c">Blending</a><ul><li class="level2"><a href="#advancedAnimation_c_a">1D blending</a></li>
<li class="level2"><a href="#advancedAnimation_c_b">2D blending</a></li>
<li class="level2"><a href="#advancedAnimation_c_c">Additive blending</a></li>
</ul>
</li>
<li class="level1"><a href="#advancedAnimation_d">Animation states</a></li>
</ul>
</div>
<div class="textblock"><p>So far we have shown how you can use the <b>Animation</b> component to play a single animation clip at once. When it comes to skeletal animation the system is capable of a few more advanced features that allow you to play and blend multiple animation clips at once, as well as other advanced functionality.</p>
<h1><a class="anchor" id="advancedAnimation_a"></a>
Cross fade</h1>
<p>Often your animation system might need to transition from playing one animation clip to another (e.g. moving from a walk to a run animation). In that case you can use <a class="el" href="classbs_1_1_c_animation.html#af691183abb2622ecc82377a7a07da873">CAnimation::crossFade()</a> instead of <b>CAnimation::play()</b>. Cross fade will slowly fade in the new animation clip while fading out the previously playing one, over the specified time period.</p>
<div class="fragment"><div class="line">CAnimation animation = ...; <span class="comment">// Set up animation component</span></div><div class="line"></div><div class="line"><span class="comment">// Play some clip normally</span></div><div class="line">animation-&gt;play(animationClip);</div><div class="line"></div><div class="line"><span class="comment">// Then after some time you decide to switch to a new clip, and cross fade it over 1 second</span></div><div class="line">animation-&gt;crossFade(animationClip2, 1.0f);</div></div><!-- fragment --><h1><a class="anchor" id="advancedAnimation_b"></a>
Sampling</h1>
<p>Sometimes it is useful to sample just a single frame from an animation clip (e.g. "freezing" an enemy in place). For such purpose you can use <a class="el" href="classbs_1_1_c_animation.html#a0ed220c69312c77aa3a068a77c9c5505">CAnimation::sample()</a>. Just provide the animation clip and the time to sample at.</p>
<div class="fragment"><div class="line"><span class="comment">// Sample animation clip at specified point</span></div><div class="line">animation-&gt;sample(animationClip, 2.0f);</div></div><!-- fragment --><h1><a class="anchor" id="advancedAnimation_c"></a>
Blending</h1>
<p>Blending comes in multiple various forms, and all of them allow you to somehow play multiple animation clips at once.</p>
<h2><a class="anchor" id="advancedAnimation_c_a"></a>
1D blending</h2>
<p>In this form of blending multiple animation clips are placed linearly one after another. The user can then use a weight value in order to interpolate between the animations. The two animations closest to the weight value are choosen and blended together.</p>
<p>For example if you had different versions of walk/run animations that alternate depending on how fast the character is moving, you could set them up as a 1D blend, and then use the characters speed as the weight, ensuring the system plays the right animation depending on the speed.</p>
<p>To start a 1D blend operation call <a class="el" href="classbs_1_1_c_animation.html#aaa884e94bf9dc85d4392576277944b50">CAnimation::blend1D()</a>. This method expects a <a class="el" href="structbs_1_1_blend1_d_info.html">Blend1DInfo</a> structure, containing a list of animations to blend between, and their positions. It also expects the weight value that determines which animations are blended together.</p>
<div class="fragment"><div class="line"><span class="comment">// Set up a 1D blend that blends between three animations on a [0, 1] range</span></div><div class="line">BlendClipInfo blendClips[3];</div><div class="line">blendClips[0].clip = animationClip0;</div><div class="line">blendClips[0].position = 0.0f;</div><div class="line"></div><div class="line">blendClips[1].clip = animationClip1;</div><div class="line">blendClips[1].position = 0.5f;</div><div class="line"></div><div class="line">blendClips[2].clip = animationClip2;</div><div class="line">blendClips[2].position = 1.0f;</div><div class="line"></div><div class="line">Blend1DInfo blendInfo;</div><div class="line">blendInfo.clips = blendClips;</div><div class="line">blendInfo.numClips = 3;</div><div class="line"></div><div class="line"><span class="comment">// Blend with weight of 0.75f. This will play both animationClip1 and animationClip2, each contributing 50% of the animation</span></div><div class="line">animation-&gt;blend1D(blendInfo, 0.75f);</div></div><!-- fragment --><h2><a class="anchor" id="advancedAnimation_c_b"></a>
2D blending</h2>
<p>2D blending works similarly as 1D blending, except it uses a two-dimensional value for the weight. It also interpolates between four animation clips at once instead of two. It is limited to four clips, and a [0, 1] range. Therefore the clips can be imagined as being on corners of a square.</p>
<p>For example you can use this blend type to interpolate between character aiming animations in a third person game. You would adjust the 2D weight based on the vertical and horizontal directions the character is aiming and the system would interpolate between look up/down/left/right animations to animate the character in the direction the user is aiming.</p>
<p>To start a 2D blend operation call <a class="el" href="classbs_1_1_c_animation.html#ad87756edab382be93b3709ff60cdda83">CAnimation::blend2D()</a>. This method expects a <a class="el" href="structbs_1_1_blend2_d_info.html">Blend2DInfo</a> structure, containing four animation clips to blend between, as well as a 2D weight determining how the animations are blended together.</p>
<div class="fragment"><div class="line"><span class="comment">// In this case you can imagine the blend square as a diamond instead (rotated 45 degrees), so its corners map with the animation directions, for a more intuitive understanding</span></div><div class="line">Blend2DInfo blendInfo;</div><div class="line">blendInfo.topLeftClip = lookLeftClip;</div><div class="line">blendInfo.topRightClip = lookUpClip;</div><div class="line">blendInfo.botLeftClip = lookDownClip;</div><div class="line">blendInfo.botRightClip = lookRightClip;</div><div class="line"></div><div class="line"><span class="comment">// Horizontal look direction is fully towards the left (x = 0.0f), while the vertical direction is in the middle (y = 0.5f), neither up nor down.</span></div><div class="line">animation-&gt;blend2D(blendInfo, Vector2(0.0f, 0.5f));</div></div><!-- fragment --><h2><a class="anchor" id="advancedAnimation_c_c"></a>
Additive blending</h2>
<p>Additive blending serves a different purpose than from what we have seen so far. It is used to play a special type of animations called additive animations. Such animation clips need to be imported with the special additive property, as discussed earlier.</p>
<p>Such animation clips can then be played on top of another primary animation. For example imagine that your character has three primary animations: standing, walking and running. Now imagine you wanted to add a weapon reload animation in the game. Instead of creating three new separate animations, you can instead create an additive animation, which can then be played on top of any of the existing three primary animations.</p>
<p>To play an additive animation call <a class="el" href="classbs_1_1_c_animation.html#a53ad4a1c4495eba810e840bdb46b9c60">CAnimation::blendAdditive()</a>. This method expects the following parameters:</p><ul>
<li>A clip to play</li>
<li>Optional weight in [0, 1] range of how much should the animation affect the result</li>
<li>Optional fade length which serves a similar purpose as the <b>CAnimation::crossFade()</b> method, allowing you to slowly increase the effect of the additive animation over time</li>
<li>Layer to play the animation on. Each additive animation can be played on its own layer - playing another additive animation on the same layer replaces the previous one.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// Play some clip normally</span></div><div class="line">animation-&gt;play(walkClip);</div><div class="line"></div><div class="line"><span class="comment">// Play a reload animation additively, slowly blending it over one second, on 0th layer</span></div><div class="line">animation-&gt;crossFade(reloadClip, 1.0f, 1.0f);</div></div><!-- fragment --><p>To stop an additive animation you can call <a class="el" href="classbs_1_1_c_animation.html#a8aa8c1d722ea1bd62741b94fe6df63c1">CAnimation::stop()</a>. It accepts a layer index as a parameter and determines which clip to stop. Calling <b>CAnimation::stopAll()</b> will stop all clips, additive or otherwise.</p>
<h1><a class="anchor" id="advancedAnimation_d"></a>
Animation states</h1>
<p><b>CAnimation</b> component allows you to retrieve and set animation states. Animation states tell you the current state of an animation clip queued for playing in some way, including whether it is currently playing, current play time, wrap mode and more.</p>
<p>Call <a class="el" href="classbs_1_1_c_animation.html#afdf5d8faf313053d423e0a0f395ec19f">CAnimation::getState()</a> with an animation clip as the parameter to retrieve information about that clip. The method outputs an <a class="el" href="structbs_1_1_animation_clip_state.html">AnimationClipState</a> that can be used to query various information about the clip.</p>
<div class="fragment"><div class="line">AnimationClipState state;</div><div class="line"></div><div class="line"><span class="comment">// Returns true if the clip was queued for playback (in any way) on the component</span></div><div class="line"><span class="keywordflow">if</span>(animation-&gt;getState(animationClip, state))</div><div class="line">    <a class="code" href="group___debug.html#ga3d2df36e0b331304f012c778c43d86a9">gDebug</a>().<a class="code" href="classbs_1_1_debug.html#acb8d76b720a9ce83aff8bcef5340151b">logDebug</a>(<span class="stringliteral">&quot;Animation is currently at time: &quot;</span> + <a class="code" href="group___string.html#ga852e40fdd80b537b8ccf93e9cefe0e2b">toString</a>(state.time));</div></div><!-- fragment --><p>More important that querying information, states can be used for starting playback, as well as having full control over blending and similar operations. Essentially all animation playback methods discussed so far can be implemented just by using states.</p>
<p>To set a clip state call <a class="el" href="classbs_1_1_c_animation.html#a7f28f37461c1b0f13930a6db40b1e08f">CAnimation::setState()</a>. If a particular clip is already playing its state will be updated, and if the clip isn't currently playing, playback will start according to the assigned state.</p>
<p>The state has the following relevant properties:</p><ul>
<li><a class="el" href="structbs_1_1_animation_clip_state.html#a8b8dfe2335a5bf90695960dc6a1c5d3b">AnimationClipState::time</a> - Allows you to seek animation playback to a specific point.</li>
<li><a class="el" href="structbs_1_1_animation_clip_state.html#a7f7e4724cf57d59513b39c5ecc81adc8">AnimationClipState::speed</a> - Scale to speed up or slow down animation clip playback.</li>
<li><a class="el" href="structbs_1_1_animation_clip_state.html#a8128625c9e3fd04c27b82957732d8781">AnimationClipState::weight</a> - Influence of the animation clip on the final pose. Useful for additive animations primarily.</li>
<li><a class="el" href="structbs_1_1_animation_clip_state.html#ae8ac0d222193c533756d793e0f8df916">AnimationClipState::wrapMode</a> - Wrap mode same as <b>CAnimation::setWrapMode()</b> except it can be set for each clip individually.</li>
<li><a class="el" href="structbs_1_1_animation_clip_state.html#a52341252c46218e1e646502024c4f30c">AnimationClipState::layer</a> - Layer used for additive animations.</li>
<li><a class="el" href="structbs_1_1_animation_clip_state.html#a4bbd5ff52abed3e07aa5205f1179d9d3">AnimationClipState::stopped</a> - When true the system will not advance the animation past the specified time.</li>
</ul>
<div class="fragment"><div class="line">AnimationClipState state;</div><div class="line">state.time = 2.0f;</div><div class="line"></div><div class="line"><span class="comment">// Start animation playback from 2 second mark</span></div><div class="line">animation-&gt;setState(animationClip, state);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
