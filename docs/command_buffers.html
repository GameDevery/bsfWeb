<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Command buffers</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='https://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Command buffers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#commandBuffers_a">Creation</a></li>
<li class="level1"><a href="#commandBuffers_b">Usage</a></li>
<li class="level1"><a href="#commandBuffers_c">Submitting</a></li>
</ul>
</div>
<div class="textblock"><p>Rendering can be a very CPU heavy operation even though GPU does all the rendering - but CPU is still the one submitting all those commands. For this purpose bs::f provides a <a class="el" href="classbs_1_1ct_1_1_command_buffer.html">ct::CommandBuffer</a> object. This object allows you to queue low-level rendering commands on different threads, allowing you to better distribute the CPU usage. Normally rendering commands are only allowed to be submitted from the core thread, but when using command buffers you are allowed to use a different thread for each command buffer.</p>
<p>Almost every method on <b>RenderAPI</b> accepts a <b>CommandBuffer</b> as its last parameter. If you don't provide one the system will instead use its primary internal command buffer. When you do you can use <b>RenderAPI</b> from different threads safely.</p>
<blockquote class="doxtable">
<p>Note: At this point command buffers are only natively supported by the Vulkan render API and will be emulated on others. This means there will be no performance benefit on non-Vulkan render APIs. </p>
</blockquote>
<h1><a class="anchor" id="commandBuffers_a"></a>
Creation</h1>
<p>To create a <b>CommandBuffer</b> call <a class="el" href="classbs_1_1ct_1_1_command_buffer.html#a77d45d0d2ee19d50e3a47e6cac7922cd">ct::CommandBuffer::create()</a> with <a class="el" href="group___utility-_core.html#gaae4332b3fb3b65c455dda069edf74933">GpuQueueType</a> as the parameter. <b>GpuQueueType</b> can be:</p><ul>
<li><a class="el" href="group___utility-_core.html#ggaae4332b3fb3b65c455dda069edf74933ae71605a8860c14bed53ecde78552ab73">GQT_GRAPHICS</a> - This is the default command buffer type that supports all type of operations.</li>
<li><a class="el" href="group___utility-_core.html#ggaae4332b3fb3b65c455dda069edf74933a446913add551c97587c6cb34337925f3">GQT_COMPUTE</a> - Command buffer type that only supports compute operations.</li>
</ul>
<p>If you know a command buffer will only execute compute operations it is beneficial to only create it using <b>GQT_COMPUTE</b>.</p>
<div class="fragment"><div class="line">SPtr&lt;CommandBuffer&gt; cmds = CommandBuffer::create(<a class="code" href="group___utility-_core.html#ggaae4332b3fb3b65c455dda069edf74933ae71605a8860c14bed53ecde78552ab73">GQT_GRAPHICS</a>);</div></div><!-- fragment --><h1><a class="anchor" id="commandBuffers_b"></a>
Usage</h1>
<p>Once created simply provide it to any relevant <b>RenderAPI</b> calls as the last parameter.</p>
<div class="fragment"><div class="line">RenderAPI&amp; rapi = RenderAPI::instance();</div><div class="line"></div><div class="line"><span class="comment">// ... bind pipeline, vertex/index buffers, etc.</span></div><div class="line">rapi.drawIndexed(0, numIndices, 0, numVertices, 1 cmds);</div></div><!-- fragment --><h1><a class="anchor" id="commandBuffers_c"></a>
Submitting</h1>
<p>Commands queued on a command buffer will only get executed after the command buffer is submitted. Submission is done by calling <a class="el" href="classbs_1_1ct_1_1_render_a_p_i.html#a86bdd357983b845df4c0a070ed47669b">ct::RenderAPI::submitCommandBuffer()</a>.</p>
<div class="fragment"><div class="line">RenderAPI&amp; rapi = RenderAPI::instance();</div><div class="line">rapi.submitCommandBuffer(cmds);</div></div><!-- fragment --><p>The default command buffer (one used when you provide no command buffer to <b>RenderAPI</b>) is automatically submitted on a call to <b>RenderAPI::swapBuffers()</b>.</p>
<p>Note that even though command buffers can be populated with commands on various threads, <b>ct::RenderAPI::submitCommandBuffer()</b> must only be called from the core thread. You must also externally synchronize access to <b>CommandBuffer</b> when passing it between threads, as it is not thread safe. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
