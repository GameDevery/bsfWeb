<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120676613-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-120676613-1');
</script>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Creating components</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='https://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Creating components </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#customComponents_a">Creation</a></li>
<li class="level1"><a href="#customComponents_b">Logic</a></li>
<li class="level1"><a href="#customComponents_c">Component handle</a></li>
<li class="level1"><a href="#customComponents_d">Using the component</a></li>
<li class="level1"><a href="#customComponents_e">Data</a></li>
<li class="level1"><a href="#customComponents_f">Activating/deactivating a scene object</a></li>
<li class="level1"><a href="#customComponents_g">Getting notified on scene object change</a></li>
</ul>
</div>
<div class="textblock"><p>So far we have talked about using built-in components like <a class="el" href="classbs_1_1_c_camera.html">Camera</a> and <a class="el" href="classbs_1_1_c_renderable.html">Renderable</a>, but another major way you'll be using components is to create your own. Components serve as the main place to put your gameplay logic in, and this is where you'll be adding a majority of your custom code when creating a game.</p>
<h1><a class="anchor" id="customComponents_a"></a>
Creation</h1>
<p>To create your own component simply implement the <a class="el" href="classbs_1_1_component.html">Component</a> interface by deriving from it. Component's constructor must always accept a handle to a <b>SceneObject</b>, which represents the scene object the component is part of.</p>
<div class="fragment"><div class="line"><span class="comment">// A simple component that does nothing</span></div><div class="line"><span class="keyword">class </span>CCameraFlyer : <span class="keyword">public</span> <a class="code" href="group___physics.html#gga7cb6db30c601dfbec9036428d0e49d33a2cb05e4bb7830be982f0922fed86b4cd">Component</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    CCameraFlyer(<span class="keyword">const</span> HSceneObject&amp; parent)</div><div class="line">        :<a class="code" href="group___physics.html#gga7cb6db30c601dfbec9036428d0e49d33a2cb05e4bb7830be982f0922fed86b4cd">Component</a>(parent)</div><div class="line">    {}</div><div class="line">};</div></div><!-- fragment --><h1><a class="anchor" id="customComponents_b"></a>
Logic</h1>
<p>Each component implementation can override any of the three primary methods for introducing gameplay logic:</p><ul>
<li><a class="el" href="classbs_1_1_component.html#aee0e9ca957f0a06be543dbe0d7e5b660">Component::onInitialized</a> - Called once when the component is first instantiated. You should use this instead of the constructor for initialization.</li>
<li><a class="el" href="classbs_1_1_component.html#acd36d7881ea8503d5c5824e7a5ad6c7e">Component::update</a> - Called every frame while the game is running and the component is enabled.</li>
<li><a class="el" href="classbs_1_1_component.html#a2e1bc238784bd8747e9a6ff5ff34a725">Component::fixedUpdate</a> - Similar to <code>update()</code> except it gets called at a fixed time interval (e.g. 60 times per second, instead of every frame). Normally you want to use this method for physics-related functionality, which requires fixed time increments in order to ensure stability of calculations.</li>
<li><a class="el" href="classbs_1_1_component.html#afc0422f03bb9d94c876942be3f471871">Component::onDestroyed</a> - Called just before the component is destroyed. Use this instead of the destructor for cleanup.</li>
</ul>
<p>Here is a simple implementation of a component using a few of these methods to implement basic camera movement. </p><div class="fragment"><div class="line"><span class="comment">// A simple component that moves a Camera component attached to the same SceneObject</span></div><div class="line"><span class="keyword">class </span>CCameraFlyer : <span class="keyword">public</span> <a class="code" href="group___physics.html#gga7cb6db30c601dfbec9036428d0e49d33a2cb05e4bb7830be982f0922fed86b4cd">Component</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Basic constructor same as above</span></div><div class="line">    CCameraFlyer(<span class="keyword">const</span> HSceneObject&amp; parent)</div><div class="line">        :<a class="code" href="group___physics.html#gga7cb6db30c601dfbec9036428d0e49d33a2cb05e4bb7830be982f0922fed86b4cd">Component</a>(parent)</div><div class="line">    {}</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="comment">// Called once when component is first added to a scene object</span></div><div class="line">    <span class="keywordtype">void</span> onInitialized()<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <span class="comment">// Find the camera component we&#39;ll be influencing (assumed to be on the same scene object)</span></div><div class="line">        mCamera = SO()-&gt;getComponent&lt;CCamera&gt;();</div><div class="line"></div><div class="line">        <span class="comment">// Create virtual buttons we&#39;ll be using for movement (assuming we registered them previously)</span></div><div class="line">        mMoveForward = VirtualButton(<span class="stringliteral">&quot;Forward&quot;</span>);</div><div class="line">        mMoveBack = VirtualButton(<span class="stringliteral">&quot;Back&quot;</span>);</div><div class="line">        mMoveLeft = VirtualButton(<span class="stringliteral">&quot;Left&quot;</span>);</div><div class="line">        mMoveRight = VirtualButton(<span class="stringliteral">&quot;Right&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Called every frame while the component is active</span></div><div class="line">    <span class="keywordtype">void</span> update()<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <span class="comment">// Check if any movement or rotation keys are being held</span></div><div class="line">        <span class="keywordtype">bool</span> goingForward = <a class="code" href="group___input-_engine.html#gae068dae812bf799effaad91c83eec974">gVirtualInput</a>().<a class="code" href="classbs_1_1_virtual_input.html#a32995c95df2349cac014866324fe20d8">isButtonHeld</a>(mMoveForward);</div><div class="line">        <span class="keywordtype">bool</span> goingBack = <a class="code" href="group___input-_engine.html#gae068dae812bf799effaad91c83eec974">gVirtualInput</a>().<a class="code" href="classbs_1_1_virtual_input.html#a32995c95df2349cac014866324fe20d8">isButtonHeld</a>(mMoveBack);</div><div class="line">        <span class="keywordtype">bool</span> goingLeft = <a class="code" href="group___input-_engine.html#gae068dae812bf799effaad91c83eec974">gVirtualInput</a>().<a class="code" href="classbs_1_1_virtual_input.html#a32995c95df2349cac014866324fe20d8">isButtonHeld</a>(mMoveLeft);</div><div class="line">        <span class="keywordtype">bool</span> goingRight = <a class="code" href="group___input-_engine.html#gae068dae812bf799effaad91c83eec974">gVirtualInput</a>().<a class="code" href="classbs_1_1_virtual_input.html#a32995c95df2349cac014866324fe20d8">isButtonHeld</a>(mMoveRight); </div><div class="line"></div><div class="line">        <span class="comment">// If the movement button is pressed, determine direction to move in</span></div><div class="line">        Vector3 direction = Vector3::ZERO;</div><div class="line">        <span class="keywordflow">if</span> (goingForward) direction += SO()-&gt;getForward();</div><div class="line">        <span class="keywordflow">if</span> (goingBack) direction -= SO()-&gt;getForward();</div><div class="line">        <span class="keywordflow">if</span> (goingRight) direction += SO()-&gt;getRight();</div><div class="line">        <span class="keywordflow">if</span> (goingLeft) direction -= SO()-&gt;getRight();</div><div class="line"></div><div class="line">        <span class="comment">// Multiply direction with speed and move in the direction</span></div><div class="line">        <span class="keywordtype">float</span> frameDelta = <a class="code" href="group___general.html#ga87bc3999f37b96ff9dfb50c554e38827">gTime</a>().<a class="code" href="classbs_1_1_time.html#a9ed4fa697ee0d9514a01310ead2b1ac4">getFrameDelta</a>();</div><div class="line">        <span class="keywordtype">float</span> speed = 10.0f;</div><div class="line"></div><div class="line">        Vector3 velocity = direction * speed;</div><div class="line">        SO()-&gt;move(velocity * frameDelta);</div><div class="line">    }</div><div class="line"></div><div class="line">    HCamera mCamera; <span class="comment">// Camera component that is influenced by this component.</span></div><div class="line"></div><div class="line">    <span class="comment">// Virtual keys we will use for movement</span></div><div class="line">    VirtualButton mMoveForward;</div><div class="line">    VirtualButton mMoveBack;</div><div class="line">    VirtualButton mMoveLeft;</div><div class="line">    VirtualButton mMoveRight;</div><div class="line">};</div></div><!-- fragment --><blockquote class="doxtable">
<p>Use <a class="el" href="classbs_1_1_component.html#a0ebc3bb000ea7fc75d56949105f74dc7">Component::SO()</a> to access the scene object the component is attached to. </p>
</blockquote>
<blockquote class="doxtable">
<p><b><a class="el" href="group___general.html#ga87bc3999f37b96ff9dfb50c554e38827" title="Easier way to access the Time module. ">gTime()</a></b> method provides access to a variety of timing related functionality, and is explained later in the <a class="el" href="time.html">timing manual</a>. </p>
</blockquote>
<h1><a class="anchor" id="customComponents_c"></a>
Component handle</h1>
<p>You will also likely want to declare a handle you can use to easily access the component, same as <b>HCamera</b> or <b>HRenderable</b>. This is done by simply creating a <em>typedef</em> on the <a class="el" href="classbs_1_1_game_object_handle.html">GameObjectHandle&lt;T&gt;</a> object.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> GameObjectHandle&lt;CCameraFlyer&gt; HCameraFlyer;</div></div><!-- fragment --><h1><a class="anchor" id="customComponents_d"></a>
Using the component</h1>
<p>We now have everything ready to use the component. You can create the component as any other by adding it to the scene object.</p>
<div class="fragment"><div class="line"><span class="comment">// Create a scene object to add our component to</span></div><div class="line">HSceneObject cameraSO = SceneObject::create(<span class="stringliteral">&quot;Camera&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// We create a Camera component since our component relies on it</span></div><div class="line">HCamera camera = cameraSO-&gt;addComponent&lt;CCamera&gt;(primaryWindow);</div><div class="line"></div><div class="line"><span class="comment">// And finally we add our component</span></div><div class="line">HCameraFlyer = cameraSO-&gt;addComponent&lt;CCameraFlyer&gt;();</div></div><!-- fragment --><h1><a class="anchor" id="customComponents_e"></a>
Data</h1>
<p>Often a component will contain some data which you want to persist after the scene is saved, which requires you to implement a special interface on your custom component class. We'll talk more about this in the next chapter.</p>
<h1><a class="anchor" id="customComponents_f"></a>
Activating/deactivating a scene object</h1>
<p>Any scene object can be temporarily de-activated and reactivated by calling <a class="el" href="classbs_1_1_scene_object.html#a92f6a09fee97399e88ace3f852323f30">SceneObject::setActive()</a>. When a scene object is deactivated its components will not have <b>Component::update()</b> called.</p>
<p>Your component can also be notified at the exact moment when activation/deactivation happens. This way you can perform additional functionality if needed. Override <a class="el" href="classbs_1_1_component.html#a8374a37e8f515a6241431fb57e94aab1">Component::onEnabled</a> and <a class="el" href="classbs_1_1_component.html#ab9aa4f5da853a30e1faffd4aca84480f">Component::onDisabled</a> to get notified every time a component is activated and deactivated, respectively.</p>
<div class="fragment"><div class="line"><span class="comment">// We&#39;re just extending the component we defined above</span></div><div class="line"><span class="keyword">class </span>CCameraFlyer : <span class="keyword">public</span> <a class="code" href="group___physics.html#gga7cb6db30c601dfbec9036428d0e49d33a2cb05e4bb7830be982f0922fed86b4cd">Component</a></div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> onDisabled()<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <a class="code" href="group___debug.html#ga3d2df36e0b331304f012c778c43d86a9">gDebug</a>().<a class="code" href="classbs_1_1_debug.html#a653887a23b659adce66243a4ae16e741">log</a>(<span class="stringliteral">&quot;Component disabled.&quot;</span>);</div><div class="line">    }   </div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> onEnabled()<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <a class="code" href="group___debug.html#ga3d2df36e0b331304f012c778c43d86a9">gDebug</a>().<a class="code" href="classbs_1_1_debug.html#a653887a23b659adce66243a4ae16e741">log</a>(<span class="stringliteral">&quot;Component enabled.&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    ...</div><div class="line">};</div></div><!-- fragment --><h1><a class="anchor" id="customComponents_g"></a>
Getting notified on scene object change</h1>
<p>Sometimes you want to get notified when the scene object the component is attached to moves or changes parents. You can do this by overriding the <a class="el" href="classbs_1_1_component.html#ae5d3835dd6df1162191d1f6ddd9ad23a">Component::onTransformChanged()</a> method.</p>
<div class="fragment"><div class="line"><span class="comment">// We&#39;re just extending the component we defined above</span></div><div class="line"><span class="keyword">class </span>CCameraFlyer : <span class="keyword">public</span> <a class="code" href="group___physics.html#gga7cb6db30c601dfbec9036428d0e49d33a2cb05e4bb7830be982f0922fed86b4cd">Component</a></div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> onTransformChanged(<a class="code" href="group___scene-_internal.html#ga09e2e9eabf04273ee9ff0d8df6e790c9">TransformChangedFlags</a> flags)<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <span class="keywordflow">if</span>((flags &amp; <a class="code" href="group___scene-_internal.html#gga09e2e9eabf04273ee9ff0d8df6e790c9a87454482d0eb5cde942cd77800ed4e30">TCF_Transform</a>) != 0)</div><div class="line">            <a class="code" href="group___debug.html#ga3d2df36e0b331304f012c778c43d86a9">gDebug</a>().<a class="code" href="classbs_1_1_debug.html#acb8d76b720a9ce83aff8bcef5340151b">logDebug</a>(<span class="stringliteral">&quot;Parent SO moved.&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>((flags &amp; <a class="code" href="group___scene-_internal.html#gga09e2e9eabf04273ee9ff0d8df6e790c9a218545897b4248ace87272b45b49b437">TCF_Parent</a>) != 0)</div><div class="line">            <a class="code" href="group___debug.html#ga3d2df36e0b331304f012c778c43d86a9">gDebug</a>().<a class="code" href="classbs_1_1_debug.html#acb8d76b720a9ce83aff8bcef5340151b">logDebug</a>(<span class="stringliteral">&quot;Scene object parent changed.&quot;</span>);</div><div class="line">    }   </div><div class="line"></div><div class="line">    ...</div><div class="line">};</div></div><!-- fragment --><p><a class="el" href="group___scene-_internal.html#ga09e2e9eabf04273ee9ff0d8df6e790c9">TransformChangedFlags</a> parameter will notify you whether the scene object moved, has changed parents, or both.</p>
<p>Note that <b>Component::onTransformChanged</b> will never trigger by default. You must first enable it by calling <a class="el" href="classbs_1_1_component.html#a072cecd74349deb5a892263568ed46da">Component::setNotifyFlags()</a>. It accepts the same <b>TransformChangedFlags</b> parameter which tells the system in which cases should it trigger <b>Component::onTransformChanged</b>.</p>
<div class="fragment"><div class="line"><span class="comment">// We&#39;re just extending the component we defined above</span></div><div class="line"><span class="keyword">class </span>CCameraFlyer : <span class="keyword">public</span> <a class="code" href="group___physics.html#gga7cb6db30c601dfbec9036428d0e49d33a2cb05e4bb7830be982f0922fed86b4cd">Component</a></div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> onInitialized()<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <span class="comment">// Get notified when the scene object moves</span></div><div class="line">        setNotifyFlags(<a class="code" href="group___scene-_internal.html#gga09e2e9eabf04273ee9ff0d8df6e790c9a87454482d0eb5cde942cd77800ed4e30">TCF_Transform</a>);</div><div class="line">    }   </div><div class="line"></div><div class="line">    ...</div><div class="line">};</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
