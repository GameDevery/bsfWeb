<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Playing animation</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='https://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Playing animation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#animation_a">Playback</a><ul><li class="level2"><a href="#animation_a_a">Play on wake</a></li>
</ul>
</li>
<li class="level1"><a href="#animation_b">Morph shapes</a></li>
<li class="level1"><a href="#animation_c">Mesh culling</a></li>
</ul>
</div>
<div class="textblock"><p>Animation playback is handled through the <a class="el" href="classbs_1_1_c_animation.html">Animation</a> component. This component must be attached to the same <b>SceneObject</b> as the <b>Renderable</b> of the object we wish to animate.</p>
<div class="fragment"><div class="line">HSceneObject animRenderableSO = SceneObject::create(<span class="stringliteral">&quot;Animated 3D object&quot;</span>);</div><div class="line">animRenderableSO-&gt;addComponent&lt;CRenderable&gt;();</div><div class="line"><span class="comment">// ...set up renderable mesh and material...</span></div><div class="line"></div><div class="line">animation = animRenderableSO-&gt;addComponent&lt;CAnimation&gt;();</div></div><!-- fragment --><h1><a class="anchor" id="animation_a"></a>
Playback</h1>
<p>To start animation playback simply call <a class="el" href="classbs_1_1_c_animation.html#a39e9cc8a0dab173e675802c7a7ab52bc">CAnimation::play()</a>, with the <b>AnimationClip</b> you wish to play as the parameter.</p>
<div class="fragment"><div class="line">animation-&gt;play(animationClip);</div></div><!-- fragment --><p>To stop playback call <a class="el" href="classbs_1_1_c_animation.html#a4823aa91e33925c0da5969f5011c07da">CAnimation::stopAll()</a>.</p>
<div class="fragment"><div class="line">animation-&gt;stopAll();</div></div><!-- fragment --><p>To check if animation is currently playing call <a class="el" href="classbs_1_1_c_animation.html#a389ad71786b00ae81f69060f153509d2">CAnimation::isPlaying()</a>.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(animation-&gt;isPlaying())</div><div class="line">    <a class="code" href="group___debug.html#ga3d2df36e0b331304f012c778c43d86a9">gDebug</a>().<a class="code" href="classbs_1_1_debug.html#acb8d76b720a9ce83aff8bcef5340151b">logDebug</a>(<span class="stringliteral">&quot;Animation is playing!&quot;</span>);</div></div><!-- fragment --><p>You can control the speed of the playback through <a class="el" href="classbs_1_1_c_animation.html#a5466c67c5ec22359c0702dc4ac8ffb19">CAnimation::setSpeed()</a>. The default value is 1, which represents normal speed, while lower values slow down playback accordingly (e.g. 0.5 is half speed) and higher values speed it up (2 is double speed). Use negative values to play animation in reverse. You can change animation speed during or before you start playing a clip.</p>
<div class="fragment"><div class="line">animation-&gt;setSpeed(2.0f);</div></div><!-- fragment --><p>Finally, you can decide what happens when the animation clip reaches the end. By calling <a class="el" href="classbs_1_1_c_animation.html#aec9a01bf50f749f50a03fb9451b126a5">CAnimation::setWrapMode()</a> with the parameter of type <a class="el" href="group___animation-_internal.html#gad649f92711dfc4694e0f95608a6366f6">AnimWrapMode</a> you can choose:</p><ul>
<li><a class="el" href="group___animation-_internal.html#ggad649f92711dfc4694e0f95608a6366f6a08825280e3f8137556325061ba67ff8c">AnimWrapMode::Clamp</a> - Once the end is reached the animation will stop.</li>
<li><a class="el" href="group___animation-_internal.html#ggad649f92711dfc4694e0f95608a6366f6a89d7b10cb4238977d2b523dfd9ea7745">AnimWrapMode::Loop</a> - Once the end is reached the animation will loop back to the beginning, and continue to do so indefinitely, until manually stopped.</li>
</ul>
<div class="fragment"><div class="line">animation-&gt;setWrapMode(AnimWrapMode::Loop);</div></div><!-- fragment --><h2><a class="anchor" id="animation_a_a"></a>
Play on wake</h2>
<p>Aside from starting playback manually, you can also tell the animation component to start playing animation as soon as its component is instantiated. This can be useful for animations permanently part of the game level, so they can start playback as soon as the level is loaded.</p>
<p>To do this call <a class="el" href="classbs_1_1_c_animation.html#a55e69ebd18cd2fe055d7d2311e7ad2ca">CAnimation::setDefaultClip()</a>. The system will then keep a permanent reference to the animation clip, and automatically play it whenever the component is instantiated.</p>
<div class="fragment"><div class="line">animation-&gt;setDefaultClip(animationClip);</div></div><!-- fragment --><h1><a class="anchor" id="animation_b"></a>
Morph shapes</h1>
<p>Both skeletal and morph shape animation playback is handled as we described above. However with morph shapes there is an additional option to consider, concering morph channels. Morph shape animation consists out of one or multiple <em>morph channels</em>, each channel can have one or multiple <em>morph shapes</em>. A single shape is simply a mesh in a certain pose (i.e. shape).</p>
<p>For example, a morph animation of a raindrop splashing on the ground would have a single channel, and multiple shapes, each shape representing one shape of the raindrop as it splashes. For such animations no additional tweaking is necessary, as the interpolation between the different shapes is done by the animation clip.</p>
<p>But when a morph animation has multiple channels, you must manually control which channels are visible by calling <a class="el" href="classbs_1_1_c_animation.html#a97e30e3231ba2350c3ba6a616406350b">CAnimation::setMorphChannelWeight()</a>. The weight should be in [0, 1] range, where channels with 0 weight with not be visible at all, and ones with weight 1 will be fully visible. Multiple channels with non-zero weights will be added together to form the final animation.</p>
<div class="fragment"><div class="line"><span class="comment">// Disable channel 0 and 2, fully enable channel 1</span></div><div class="line">animation-&gt;setMorphChannelWeight(0, 0.0f);</div><div class="line">animation-&gt;setMorphChannelWeight(1, 1.0f);</div><div class="line">animation-&gt;setMorphChannelWeight(2, 0.0f);</div></div><!-- fragment --><p>Multiple channels are particularily useful for things like facial animation. In such cases you would have one channel for each facial expression, and then modify their weights depending on what is the character feeling or saying. Such channels would also most likely only have a single shape per channel (but don't have to).</p>
<p>You can find out how many channels a morph shape animation has by retrieving a <a class="el" href="classbs_1_1_morph_shapes.html">MorphShapes</a> object from <b>Mesh</b> by calling <a class="el" href="classbs_1_1_mesh.html#a8c9ef8c08fe669770f69a9f59eb0e5ce">Mesh::getMorphShapes()</a>. Use <a class="el" href="classbs_1_1_morph_shapes.html#afcaf03eba6f1cdda44697c2542d05f43">MorphShapes::getNumChannels()</a> to get the channel count, and <a class="el" href="classbs_1_1_morph_shapes.html#a1f7d82002fde5024a519ad48893037ea">MorphShapes::getChannel()</a> to retrieve information about a channel in the form of <a class="el" href="classbs_1_1_morph_channel.html">MorphChannel</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Assuming we have a mesh imported with morph shapes</span></div><div class="line">SPtr&lt;MorphShapes&gt; morphShapes = mesh-&gt;getMorphShapes();</div><div class="line"></div><div class="line">UINT32 numChannels = morphShapes-&gt;getNumChannels();</div><div class="line"><span class="keywordflow">for</span>(UINT32 i = 0; i &lt; numChannels; i++)</div><div class="line">{</div><div class="line">    SPtr&lt;MorphChannel&gt; channel = morphShapes-&gt;getChannel(i);</div><div class="line">    <a class="code" href="group___debug.html#ga3d2df36e0b331304f012c778c43d86a9">gDebug</a>().<a class="code" href="classbs_1_1_debug.html#acb8d76b720a9ce83aff8bcef5340151b">logDebug</a>(<span class="stringliteral">&quot;Found morph channel: &quot;</span> + channel-&gt;getName());</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="animation_c"></a>
Mesh culling</h1>
<p>Normally, when objects are about to be rendered, the system tries to detect if an object is in view of the camera or not. This ensures that the GPU doesn't waste time on objects that are certain not to be visible. For the purposes of culling the system uses an approximation of the mesh to be rendered, in the form of its bounding box. This is efficient because that bounding box can be pre-calculated, stored and then easily checked for visibility.</p>
<p>But with animation the object is constantly transforming, and it is not efficient to re-calculate the bounding box with each new frame of the animation. The system then instead uses the same bounding box it would have used if the object is static. This means that if the animated object's mesh ever leaves the bounds of that box, the system could decide to cull the object, even though some part of it is still visible. This can result in noticeable graphical artifacts, but bs::f provides a way to fix the issue by providing your own bounds.</p>
<p>By providing your own bounding box, you can ensure the box is large enough to cover the entire range of motion of the animation, so that mesh at no point can leave it. This ensures no incorrect culling will happen. To do this you must first enable custom bounds by calling <a class="el" href="classbs_1_1_c_animation.html#a1310ba08a6d4c65f1724a1820fe217e4">CAnimation::setUseBounds()</a>, followed by setting the actual bounds though <a class="el" href="classbs_1_1_c_animation.html#abfed3c9c95537b9aa581716e6b3e1fb9">CAnimation::setBounds()</a>.</p>
<div class="fragment"><div class="line">animation-&gt;setUseBounds(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">AABox customBounds(Vector3(-1, -1, -1), Vector3(1, 1, 1));</div><div class="line">animation-&gt;setBounds(customBounds);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
