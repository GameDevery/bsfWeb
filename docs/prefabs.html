<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Prefabs</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='http://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="../SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="../SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Prefabs </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We talked about prefabs when discussing on how to save a game scene, but they can actually be used for saving of any group of scene objects. Contents of such prefabs can then be easily instantiated throughout the scene, allowing you to build complex scenes more easily. Prefabs can be nested within other prefabs with no limits (where the top level prefab is the "scene") and provide other useful functionality we'll talk about.</p>
<p>For example you might create a scene object that contains a <b>Renderable</b> displaying a mesh of a house a material referencing the relevant textures. The scene object could also contain physics objects like a <b>Collider</b> and even child scene objects. You could then group all the scene objects and their components into a single prefab, which you can then easily re-use all over your scene.</p>
<h1>Creation</h1>
<p>To create such a prefab call <a class="el" href="classbs_1_1_prefab.html#ac9c9adc6b27e9a6a40803c4b3ec54c80">Prefab::create()</a> with the first parameter being a <b>SceneObject</b> from which to create the prefab from. All child scene objects will be included in the prefab as well. Second parameter of <b>Prefab::create()</b> should equal to false, indicating this prefab doesn't represent a scene.</p>
<div class="fragment"><div class="line"><span class="comment">// Create a renderable object as normal</span></div><div class="line">HSceneObject renderableSO = SceneObject::create(<span class="stringliteral">&quot;3D object&quot;</span>);</div><div class="line">HRenderable renderable = renderableSO-&gt;addComponent&lt;CRenderable&gt;();</div><div class="line"><span class="comment">// Set up renderable mesh &amp; material</span></div><div class="line"></div><div class="line">HPrefab renderablePrefab = Prefab::create(renderableSO, <span class="keyword">false</span>);</div></div><!-- fragment --><h1>Instantiation</h1>
<p>Once created you can now instantiate the prefab as many times as you wish by calling <a class="el" href="classbs_1_1_prefab.html#ab1b23591c49aac69b06918b0d70dcce7">Prefab::instantiate()</a>. This will return a scene object, which will by default be parented to scene root.</p>
<div class="fragment"><div class="line">HSceneObject instance1 = renderablePrefab-&gt;instantiate();</div><div class="line">HSceneObject instance2 = renderablePrefab-&gt;instantiate();</div></div><!-- fragment --><h1>Updates</h1>
<p>Often you might want to modify the contents of a prefab. To do that call <a class="el" href="classbs_1_1_prefab.html#aad54811f3d37b6c45a4e9479d7cbb394">Prefab::update()</a>, preferably with the same scene object it was created with.</p>
<div class="fragment"><div class="line"><span class="comment">// Update mesh on our renderable prefab</span></div><div class="line">renderable-&gt;setMesh(differentMesh);</div><div class="line"></div><div class="line"><span class="comment">// Save the updated data into the prefab</span></div><div class="line">renderablePrefab-&gt;update(renderableSO);</div></div><!-- fragment --><p>Once a prefab has been updated, you might also want to update any instances of that prefab. A prefab instance is any scene object resulting from <b>Prefab::instantiate()</b>, and the scene object used for originally creating the prefab.</p>
<p>You can update the instances by calling <a class="el" href="classbs_1_1_prefab_utility.html#ad5f4803efe99eb7a2ece7defeb798aa1">PrefabUtility::updateFromPrefab()</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Update all the instances of our prefab with new prefab data (renderableSO is also an instance, but we don&#39;t update it since it was the source of the changes, so there&#39;s no need)</span></div><div class="line"></div><div class="line">PrefabUtility::updateFromPrefab(instance1);</div><div class="line">PrefabUtility::updateFromPrefab(instance2);</div></div><!-- fragment --><p>Note that this process is recursive, so you can call <b>PrefabUtility::updateFromPrefab()</b> on the entire scene, in order to update all prefabs.</p>
<div class="fragment"><div class="line">PrefabUtility::updateFromPrefab(<a class="code" href="group___scene-_internal.html#ga4fe1577fc4b8df1cfeafb164bef158a7">gSceneManager</a>().getRootNode());</div></div><!-- fragment --><h2>Links</h2>
<p>You'll notice we didn't need to provide a reference to <b>Prefab</b> when performing prefab updates. This is because every prefab instance is linked to its prefab. You can break the link by calling <a class="el" href="classbs_1_1_scene_object.html#a3d7dd15871658ee2b80c7f6662cee298">SceneObject::breakPrefabLink()</a>. This will make it into a regular scene object and it will no longer be updated from the prefab.</p>
<div class="fragment"><div class="line">instance1-&gt;breakPrefabLink();</div></div><!-- fragment --><h2>Saving</h2>
<p>If a scene using prefabs is saved to disk, and if you plan on updating the prefab later, you must save the prefabs same as we save scenes. Otherwise the next time you call <b>PrefabUtility::updateFromPrefab()</b> the system will be unable to find the prefab.</p>
<div class="fragment"><div class="line"><a class="code" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().<a class="code" href="classbs_1_1_resources.html#a2f2f27ffa0c34bce3db574c9327bd0ac">save</a>(renderablePrefab, <span class="stringliteral">&quot;myPrefab.asset&quot;</span>);</div></div><!-- fragment --><blockquote class="doxtable">
<p>Prefabs generally won't be updated during normal application runs, and therefore non-scene prefabs don't need to be distributed with your application or used outside of development. </p>
</blockquote>
<h1>Instance modifications</h1>
<p>All prefab instances are by default identical, and if you make any changes to the instances any calls to <b>PrefabUtility::updateFromPrefab()</b> will discard those changes and update the instance with latest data from the prefab. You can choose to break the prefab link by calling <b>SceneObject::breakPrefabLink()</b> but in that case you can no longer update the scene object if the source prefab changes.</p>
<p>The solution for this problem are instance modifications. Using this system you can modify prefab instance same as a normal scene object, as long as you call <a class="el" href="classbs_1_1_prefab_utility.html#a4701560433ed83fc27c0e251141d51cc">PrefabUtility::recordPrefabDiff()</a> after.</p>
<div class="fragment"><div class="line"><span class="comment">// Change the material of the prefab instance&#39;s renderable</span></div><div class="line">HRenderable instanceRenderable = instance2-&gt;getComponent&lt;CRenderable&gt;();</div><div class="line">instanceRenderable-&gt;<a class="code" href="classbs_1_1_c_renderable.html#a28842cd737839afb3aa9cdb13029a94f">setMaterial</a>(0, differentMaterial);</div><div class="line"></div><div class="line">PrefabUtility::recordPrefabDiff(instanceRenderable);</div><div class="line"><span class="comment">// Now it&#39;s safe to call PrefabUtility::updateFromPrefab() and our material change will remain even after update</span></div></div><!-- fragment --><p>Note the system will automatically call <b>PrefabUtility::recordPrefabDiff()</b> when a new prefab is created or updated. Meaning this will also be done automatically when you're saving scenes, and therefore there should be rare need to call it manually.</p>
<h2>Reverting</h2>
<p>Sometimes you might want to discard all instance modifications, and revert back to original data from the prefab. In that case you can call <a class="el" href="classbs_1_1_prefab_utility.html#ad3ace647b3c6997c2fc7793895bdd81d">PrefabUtility::revertToPrefab()</a>.</p>
<div class="fragment"><div class="line"><span class="comment">// Discard any instance specific changes and update from the latest data from the prefab</span></div><div class="line">PrefabUtility::revertToPrefab(instance2);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
