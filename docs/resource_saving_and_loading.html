<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120676613-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-120676613-1');
</script>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Resource saving and loading</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='https://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Resource saving and loading </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#resourceSavingAndLoading_a">Saving</a></li>
<li class="level1"><a href="#resourceSavingAndLoading_b">Loading</a></li>
<li class="level1"><a href="#resourceSavingAndLoading_c">Asynchronous loading</a></li>
<li class="level1"><a href="#resourceSavingAndLoading_d">Resource lifetime</a></li>
<li class="level1"><a href="#resourceSavingAndLoading_e">Weak handles</a></li>
<li class="level1"><a href="#resourceSavingAndLoading_f">Resource dependencies</a></li>
</ul>
</div>
<div class="textblock"><p>All resource save and load operations are managed through the <a class="el" href="classbs_1_1_resources.html">Resources</a> module, accessible through <a class="el" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().</p>
<h1><a class="anchor" id="resourceSavingAndLoading_a"></a>
Saving</h1>
<p>Once a resource has been imported you can save it for later use. The advantage of saving a resource (instead of importing it every time) is performance - resource import is usually a costly operation. Saved resources remain in engine-friendly format and can be easily loaded later.</p>
<p>To save a resource call <a class="el" href="classbs_1_1_resources.html#a2f2f27ffa0c34bce3db574c9327bd0ac">Resources::save()</a>. Lets see an example where we import a texture and then save it for later use:</p>
<div class="fragment"><div class="line"><span class="comment">// Import a texture named &quot;myTexture.jpg&quot; from the disk</span></div><div class="line">HTexture texture = <a class="code" href="group___importer.html#gafda9808bfcae11afa60eee731056225e">gImporter</a>().<a class="code" href="classbs_1_1_importer.html#a956425fa45716612e04b109701bdd62f">import</a>&lt;Texture&gt;(<span class="stringliteral">&quot;myTexture.jpg&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// Save the texture for later use</span></div><div class="line"><a class="code" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().<a class="code" href="classbs_1_1_resources.html#a2f2f27ffa0c34bce3db574c9327bd0ac">save</a>(texture, <span class="stringliteral">&quot;myTexture.asset&quot;</span>);</div></div><!-- fragment --><p>Note that resources can also be created within the engine, and don't necessarily have to be imported. e.g. you can populate texture pixels or mesh vertices programatically, and then save the resource in this same manner. We will show later how to manually create resources.</p>
<h1><a class="anchor" id="resourceSavingAndLoading_b"></a>
Loading</h1>
<p>Once a resource has been saved you can load it at any time using <a class="el" href="classbs_1_1_resources.html#a267a91924db1c2fbaef8da0dd760655e">Resources::load()</a>. Lets load the texture we just saved:</p>
<div class="fragment"><div class="line">HTexture loadedTexture = <a class="code" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().<a class="code" href="classbs_1_1_resources.html#a267a91924db1c2fbaef8da0dd760655e">load</a>&lt;Texture&gt;(<span class="stringliteral">&quot;myTexture.asset&quot;</span>);</div></div><!-- fragment --><blockquote class="doxtable">
<p>If you attempt to load a resource that has already been loaded, the system will return the existing resource. </p>
</blockquote>
<h1><a class="anchor" id="resourceSavingAndLoading_c"></a>
Asynchronous loading</h1>
<p>Resources can be loaded asynchronously (in the background) by calling <a class="el" href="classbs_1_1_resources.html#aa383dd3e3d6234b08d760c89c3a42380">Resources::loadAsync()</a>. The interface is identical to <b>Resources::load()</b>. The main difference is that the returned handle will contain a reference to a resource that hasn't been loaded yet.</p>
<p>You can check if a resource handle is pointing to a loaded resource by calling <a class="el" href="classbs_1_1_resource_handle_base.html#a147c4df4a6265b39a86625ba01bf01a5">ResourceHandle::isLoaded()</a>.</p>
<div class="fragment"><div class="line">HMesh mesh = <a class="code" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().<a class="code" href="classbs_1_1_resources.html#aa383dd3e3d6234b08d760c89c3a42380">loadAsync</a>(<span class="stringliteral">&quot;myMesh.asset&quot;</span>);</div><div class="line"></div><div class="line"><span class="keywordflow">if</span>(mesh.isLoaded())</div><div class="line">{</div><div class="line">    <span class="comment">// Check if loaded before doing something</span></div><div class="line">}</div></div><!-- fragment --><blockquote class="doxtable">
<p>Note that not-yet-loaded resource handles can be provided to some engine systems, but not all. Generally a system will note in its documentation if it works with such resource handles. </p>
</blockquote>
<p>You can block the current thread until a resource is loaded by calling <a class="el" href="classbs_1_1_resource_handle_base.html#a835de42e7481da49e0258c0a5fa9b93c">ResourceHandle::blockUntilLoaded()</a>.</p>
<div class="fragment"><div class="line">mesh.blockUntilLoaded();</div><div class="line"><span class="comment">// Makes sure the mesh is loaded at this point</span></div></div><!-- fragment --><h1><a class="anchor" id="resourceSavingAndLoading_d"></a>
Resource lifetime</h1>
<p>Whenever you load a resource, that resource will be kept loaded until all references to that resource are lost. Each resource handle (e.g. <b>HMesh</b>) that exists represents a single reference. By default an additional "internal" reference is also created and held by the system internally. This ensures the resource stays loaded even when all handles are destroyed.</p>
<p>This internal reference must be released by calling <a class="el" href="classbs_1_1_resources.html#a4df81b24ce1ec607fb8d446dc1780fbe">Resources::release()</a>.</p>
<div class="fragment"><div class="line"><a class="code" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().<a class="code" href="classbs_1_1_resources.html#a4df81b24ce1ec607fb8d446dc1780fbe">release</a>(mesh);</div></div><!-- fragment --><blockquote class="doxtable">
<p>Note that if you called <b>Resources::load()</b> multiple times, you must also call <b>Resources::release()</b> the same amount of times. </p>
</blockquote>
<p>But you can also force the system to not create the internal reference by passing a custom <a class="el" href="group___resources.html#ga24c5b7027e3c55f3e940f269cf805fd1">ResourceLoadFlag</a> to the <a class="el" href="classbs_1_1_resources.html#a267a91924db1c2fbaef8da0dd760655e">Resources::load()</a> method. This flag should not include the <a class="el" href="group___resources.html#gga24c5b7027e3c55f3e940f269cf805fd1a0daf2c3cb75f4671119d9606f3b5a838">ResourceLoadFlag::KeepInternalRef</a>.</p>
<div class="fragment"><div class="line">HMesh mesh = <a class="code" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().<a class="code" href="classbs_1_1_resources.html#a267a91924db1c2fbaef8da0dd760655e">load</a>(<span class="stringliteral">&quot;myMesh.asset&quot;</span>, ResourceLoadFlag::Default &amp; ~ResourceLoadFlag::KeepInternalRef);</div></div><!-- fragment --><h1><a class="anchor" id="resourceSavingAndLoading_e"></a>
Weak handles</h1>
<p>In case you want to keep a reference to a resource without incrementing the reference count you can use a weak handle instead of a normal one. Weak handles are represented by the <a class="el" href="group___resources.html#ga5bdb9d3ef0e9e3dd63aaa9f0e06a83e8">WeakResourceHandle&lt;T&gt;</a> class and can be retrieved from normal handles by calling <a class="el" href="classbs_1_1_t_resource_handle.html#a6fca710a07f10926a35660efbca43576">ResourceHandle&lt;T&gt;::getWeak()</a>. Other than that they are accessed the same as normal handles.</p>
<div class="fragment"><div class="line"><span class="comment">// Load a mesh and store a handle as normal</span></div><div class="line">HMesh mesh = <a class="code" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().<a class="code" href="classbs_1_1_resources.html#a267a91924db1c2fbaef8da0dd760655e">load</a>(<span class="stringliteral">&quot;myMesh.asset&quot;</span>);</div><div class="line"></div><div class="line"><span class="comment">// Create a weak handle</span></div><div class="line">WeakResourceHandle&lt;Mesh&gt; weakMesh = mesh.<a class="code" href="classbs_1_1_t_resource_handle.html#a6fca710a07f10926a35660efbca43576">getWeak</a>();</div></div><!-- fragment --><h1><a class="anchor" id="resourceSavingAndLoading_f"></a>
Resource dependencies</h1>
<p>Whenever you load a resource the system will automatically enumerate all dependencies of that resource and attempt to load them as well. For example when loading a <b>Material</b> it will automatically load its <b>Shader</b> and any referenced <b>Texture</b> resources.</p>
<p>In case you wish to prevent that you can not provide the <a class="el" href="group___resources.html#gga24c5b7027e3c55f3e940f269cf805fd1afb8fb1850c3930498feee6ab3e19bfdc">ResourceLoadFlag::LoadDependencies</a> flag when calling <b>Resources::load()</b> (provided by default).</p>
<div class="fragment"><div class="line"><span class="comment">// Loads a resource without any dependencies, nor keeps an internal reference</span></div><div class="line">HMesh mesh = <a class="code" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().<a class="code" href="classbs_1_1_resources.html#a267a91924db1c2fbaef8da0dd760655e">load</a>(<span class="stringliteral">&quot;myMesh.asset&quot;</span>, ResourceLoadFlag::None);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
