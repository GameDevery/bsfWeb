<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Renderer extensions</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='https://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Renderer extensions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#rendererExt_a">Creating extensions</a></li>
<li class="level1"><a href="#rendererExt_b">Registering an extension</a></li>
<li class="level1"><a href="#rendererExt_c">Initialization</a></li>
<li class="level1"><a href="#rendererExt_d">Destruction</a></li>
<li class="level1"><a href="#rendererExt_e">Communicating with the extension</a></li>
</ul>
</div>
<div class="textblock"><p>Renderer is a system that processes all renderable objects in the scene, renders them, applies lighting and shadows, renders overlay elements such as GUI and applies post processing effects. It is the system that determines how your game looks (together with custom materials you might specify). In bs::f the renderer is implemented as a plugin, so you may create your own and fully customize the look of your game. bs::f also comes with a default renderer called "RenderBeast".</p>
<p>In this chapter we'll show how to create extensions to the renderer, which are primarily useful when adding systems that need to perform rendering, but you do not wish to completely replace existing renderer functionality, but rather add to it. Such systems might perform particle effect rendering, GUI overlays, custom 2D rendering and similar.</p>
<h1><a class="anchor" id="rendererExt_a"></a>
Creating extensions</h1>
<p>To create a renderer extensions implement your own class deriving from <a class="el" href="classbs_1_1_renderer_extension.html">RendererExtension</a>. Note it is a core thread class, as all rendering is executed on the core thread.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyRendererExtension : <span class="keyword">public</span> RendererExtension</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    MyRendererExtension();</div><div class="line">}</div></div><!-- fragment --><p>Your implementation needs to pass two parameters to the base <b>RendererExtension</b> class. The first parameter is of type <a class="el" href="group___renderer-_internal.html#gad244a776bf94423ce48080ab84674ab7">RenderLocation</a> which determines at which point during rendering will your extension be triggered. It can be any of the following values, which are executed in the order specified:</p><ul>
<li><a class="el" href="group___renderer-_internal.html#ggad244a776bf94423ce48080ab84674ab7a8ef6a8a47e4b30f792840082ac499178">RenderLocation::PreBasePass</a> - Triggered before any scene objects are rendered. The renderer guarantees the render targets used for rendering scene objects will be bound (e.g. GBuffer).</li>
<li><a class="el" href="group___renderer-_internal.html#ggad244a776bf94423ce48080ab84674ab7adb3735cd0f3440c360f03bfd6eb6fad9">RenderLocation::PostBasePass</a> - Triggered after scene objects are rendered, but before they are lit. The renderer guarantees the render targets used for rendering scene objects will be bound (e.g. GBuffer).</li>
<li><a class="el" href="group___renderer-_internal.html#ggad244a776bf94423ce48080ab84674ab7a395bec45ac74a23b8f93c81850c1e404">RenderLocation::PostLightPass</a> - Triggered after all scene objects have been rendered and their final information has been written to the final scene color buffer, without any post-processing. The renderer guarantees the final scene color render target will be bound.</li>
<li><a class="el" href="group___renderer-_internal.html#ggad244a776bf94423ce48080ab84674ab7a6b551379c3c0b59326abdaf3b4395bd3">RenderLocation::Overlay</a> - Triggered after all scene objects have been rendered and their final information has been written to the final scene color buffer, with post-processing. The renderer guarantees the final scene color render target will be bound.</li>
</ul>
<p>The second parameter is the priority. It determines in what order will renderer extensions attached to the same render location be executed. Those with higher priority will execute before those with lower priority.</p>
<div class="fragment"><div class="line"><span class="comment">// Renderer extension with necessary constructor arguments</span></div><div class="line"><span class="keyword">class </span>MyRendererExtension : <span class="keyword">public</span> RendererExtension</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    MyRendererExtension()</div><div class="line">        : RendererExtension(<a class="code" href="group___renderer-_internal.html#gad244a776bf94423ce48080ab84674ab7">RenderLocation</a>::<a class="code" href="group___renderer-_internal.html#ggad244a776bf94423ce48080ab84674ab7a395bec45ac74a23b8f93c81850c1e404">PostLightPass</a>, 0)</div><div class="line">    { }</div><div class="line">}</div></div><!-- fragment --><p>Finally the implementation needs to implement the following methods:</p><ul>
<li><a class="el" href="classbs_1_1_renderer_extension.html#afe7866f9fb4ed58e9373d549eae6c6b1">RendererExtension::check()</a> - Called every frame for every camera in the scene. The methods accepts a camera as a parameter and return true or false whether the extension wishes to render to that camera. Some extensions might render to all cameras, others just to one or a few.</li>
<li><a class="el" href="classbs_1_1_renderer_extension.html#a6177f4883dcfb11899eb8394fac22d00">RendererExtension::render()</a> - Called every frame for every camera that the <b>ct::RendererExtension::check()</b> method returned true for. This is the method where you place the bulk of extension code and perform actual rendering. The rendering is performed using the low level rendering API as described previously. Note that this is the only method in the extension that you should be rendering from.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// Renderer extension with check() and render() methods</span></div><div class="line"><span class="keyword">class </span>MyRendererExtension : <span class="keyword">public</span> RendererExtension</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    MyRendererExtension()</div><div class="line">        : RendererExtension(<a class="code" href="group___renderer-_internal.html#gad244a776bf94423ce48080ab84674ab7">RenderLocation</a>::<a class="code" href="group___renderer-_internal.html#ggad244a776bf94423ce48080ab84674ab7a395bec45ac74a23b8f93c81850c1e404">PostLightPass</a>, 0)</div><div class="line">    { }</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> check(<span class="keyword">const</span> Camera&amp; camera)<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <span class="comment">// Render on any camera</span></div><div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> render(<span class="keyword">const</span> Camera&amp; camera)<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        RenderAPI&amp; rapi = RenderAPI::instance();</div><div class="line"></div><div class="line">        <span class="comment">// bind pipeline state, vertex/index buffers, etc.</span></div><div class="line">        rapi.drawIndexed(0, numIndices, 0, numVertices);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><blockquote class="doxtable">
<p>Your extension should never call <b>RenderAPI::setRenderTarget()</b>. Render targets are bound and managed exclusively by the renderer itself. The type of render target depends on the render location the extension is attached to. </p>
</blockquote>
<h1><a class="anchor" id="rendererExt_b"></a>
Registering an extension</h1>
<p>Once extension is implemented you need to register it with the renderer by calling <a class="el" href="classbs_1_1_renderer_extension.html#aa0aa37ab1d11fbf7419f34f7b3cd0d00">RendererExtension::create&lt;T&gt;()</a>, where the template parameter is the type of your extension. You must also provide initialization data that will be passed to the extension - this can be null.</p>
<p>Note that while extensions are executed on the core thread, they are started from the sim (main) thread.</p>
<div class="fragment"><div class="line"><span class="comment">// Calling from sim thread</span></div><div class="line">SPtr&lt;ct::MyRendererExtension&gt; rendererExt = RendererExtension::create&lt;ct::MyRendererExtension&gt;(<span class="keyword">nullptr</span>);</div></div><!-- fragment --><h1><a class="anchor" id="rendererExt_c"></a>
Initialization</h1>
<p>When implementing your extension you may optionally override the <a class="el" href="classbs_1_1_renderer_extension.html#ab72f209400fa6491dcf38182cc90771c">RendererExtension::initialize()</a> method. This method will be called on the core thread once the extension is created.</p>
<p>Note that you shouldn't use the constructor for initialization, since the constructor will trigger on the simulation thread, which is not a valid thread for rendering operations.</p>
<p><b>RendererExtension::initialize()</b> additionally also accepts the data passed to the <b>RendererExtension::create&lt;T&gt;()</b> method. The data is passed as <b>Any</b> type, meaning you can bind whatever you wish to it. Normally it is some kind of a <em>struct</em> containing the necessary initialization parameters.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>MyInitData</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> a;</div><div class="line">    <span class="keywordtype">float</span> b;</div><div class="line">    SPtr&lt;ct::Texture&gt; c;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Core thread</span></div><div class="line"><span class="keyword">class </span>MyRendererExtension : <span class="keyword">public</span> RendererExtension</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// ... other extension code</span></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> initialize(<span class="keyword">const</span> Any&amp; data)<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <span class="keyword">const</span> MyInitData&amp; initData = any_cast_ref&lt;MyInitData&gt;(data);</div><div class="line">        <span class="comment">// initialize whatever is required</span></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Sim thread</span></div><div class="line">HTexture tex = ...;</div><div class="line"></div><div class="line">MyInitData initData;</div><div class="line">initData.a = 5;</div><div class="line">initData.b = 30.0f;</div><div class="line">initData.c = tex-&gt;getCore(); <span class="comment">// Get version of texture usable on core thread</span></div><div class="line"></div><div class="line">SPtr&lt;ct::MyRendererExtension&gt; rendererExt = RendererExtension::create&lt;ct::MyRendererExtension&gt;(initData);</div></div><!-- fragment --><h1><a class="anchor" id="rendererExt_d"></a>
Destruction</h1>
<p>Similar to how you shouldn't use the constructor for initializing the extension, neither should you use the destructor for destruction. Instead if you need to perform cleanup before the extension is destroyed, override the <a class="el" href="classbs_1_1_renderer_extension.html#aed2d208f4d304cc6def0a15b73f115bf">RendererExtension::destroy()</a> method.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyRendererExtension : <span class="keyword">public</span> RendererExtension</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// ... other extension code</span></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> destroy()<span class="keyword"> override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        <span class="comment">// clean up</span></div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="rendererExt_e"></a>
Communicating with the extension</h1>
<p>If you need further communication with your extension from the sim thread, you should use the command queue as described in the <a class="el" href="core_thread.html">Core Thread</a> manual. If not using the command queue then you must ensure to use some other form of thread primitives to ensure safe communication between the two threads.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyRendererExtension : <span class="keyword">public</span> RendererExtension</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">void</span> myCustomUpdateMethod(<span class="keywordtype">float</span> newValue)</div><div class="line">    {</div><div class="line">        <span class="comment">// respond to change in value</span></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Sim thread</span></div><div class="line">ct::MyRendererExtension myExtension = ...;</div><div class="line"><span class="keywordtype">float</span> newValue = 15.0f;</div><div class="line"></div><div class="line"><span class="keyword">auto</span> executeOnCore = [&amp;]()</div><div class="line">{</div><div class="line">    myExtension-&gt;myCustomUpdateMethod(newValue);</div><div class="line">};</div><div class="line"></div><div class="line"><a class="code" href="group___core_thread-_internal.html#gaef7ed693951fb3ecc75209447cf4dc63">gCoreThread</a>().<a class="code" href="classbs_1_1_core_thread.html#a1ec463e396b7c6d278917a73202037ce">queueCommand</a>(executeOnCore);</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
