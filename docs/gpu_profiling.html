<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - GPU profiling</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='https://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GPU profiling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#gpuProfiling_a">Sampling</a></li>
<li class="level1"><a href="#gpuProfiling_b">Reporting</a></li>
</ul>
</div>
<div class="textblock"><p>GPU operations cannot be profiled using the CPU profiler as they are executed asynchronously. This means when you call a method that executes on the GPU (such as those on <b>RenderAPI</b>, as well as GPU resource read/write operations) it will return almost immediately, meaning the timing information reported by the CPU profiler will not be representative of the time it actually took to execute the operation.</p>
<p>Therefore GPU profiling is instead handled by <a class="el" href="classbs_1_1_profiler_g_p_u.html">ProfilerGPU</a>, globally accessible from <a class="el" href="group___profiling.html#gafb9af4471d21274b08c517ad52759405">gProfilerGPU()</a>. It allows you to track execution times of GPU operations, as well as other helpful information.</p>
<h1><a class="anchor" id="gpuProfiling_a"></a>
Sampling</h1>
<p>Similar to CPU profiling, you issue sampling calls using <a class="el" href="classbs_1_1_profiler_g_p_u.html#a91ccd02ac236949c12fc151545710553">ProfilerGPU::beginSample()</a> and <a class="el" href="classbs_1_1_profiler_g_p_u.html#adb61a1c082503409e09c6ba628ab0565">ProfilerGPU::endSample()</a>. Any GPU commands executed between these two calls will be measured.</p>
<div class="fragment"><div class="line">RenderAPI&amp; rapi = RenderAPI::instance();</div><div class="line"></div><div class="line"><span class="comment">// ... bind pipeline states, buffers, etc.</span></div><div class="line"></div><div class="line"><span class="comment">// Measure how long it takes the GPU to draw something</span></div><div class="line">gGPUProfiler().beginSample(<span class="stringliteral">&quot;mySample&quot;</span>);</div><div class="line">rapi.drawIndexed(0, numIndices, 0, numVertices);</div><div class="line">gGPUProfiler().endSample(<span class="stringliteral">&quot;mySample&quot;</span>);</div></div><!-- fragment --><p>Each GPU sample will measure the time to took the execute the command on the GPU, but will also measure various resource usage stats. For example it will measure number of draw calls, number of vertices/primitives drawn, render state switches, and similar.</p>
<p>All <b>ProfilerGPU::beginSample()</b> and <b>ProfilerGPU::endSample()</b> calls need to be placed in-between <a class="el" href="classbs_1_1_profiler_g_p_u.html#a41008e7968299cb0a4d55408f92f8209">ProfilerGPU::beginFrame()</a> and <a class="el" href="classbs_1_1_profiler_g_p_u.html#a275cb0fc5850b339346d533d2e65aaa8">ProfilerGPU::endFrame()</a>. As their name implies you should only call these methods once per frame. If working with the default renderer, they will be called for you by the renderer.</p>
<h1><a class="anchor" id="gpuProfiling_b"></a>
Reporting</h1>
<p>GPU profiler will generate a single report per <b>ProfilerGPU::beginFrame()</b> / <b>ProfilerGPU::endFrame()</b> pair. Since GPU is executing asynchronously the report might not be available as soon as you call <b>ProfilerGPU::endFrame()</b>. Instead you should call <a class="el" href="classbs_1_1_profiler_g_p_u.html#af75780d15ef53a2008d6c24e2a93f4df">ProfilerGPU::getNumAvailableReports()</a> to check if there is a report available. If there is one you can then call <a class="el" href="classbs_1_1_profiler_g_p_u.html#ad636186f8c4e591be4c193205ad2f00a">ProfilerGPU::getNextReport()</a> to retrieve the report. Report information is contained in a <a class="el" href="structbs_1_1_g_p_u_profiler_report.html">GPUProfilerReport</a> structure.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(ProfilerGPU::instance().getNumAvailableReports() &gt; 0)</div><div class="line">{</div><div class="line">    GPUProfilerReport report = ProfilerGPU::instance().getNextReport(); </div><div class="line">    <a class="code" href="group___debug.html#ga3d2df36e0b331304f012c778c43d86a9">gDebug</a>().<a class="code" href="classbs_1_1_debug.html#acb8d76b720a9ce83aff8bcef5340151b">logDebug</a>(<span class="stringliteral">&quot;It took &quot;</span> + report.frameSample.timeMs + <span class="stringliteral">&quot;ms to execute &quot;</span> + report.frameSample.numDrawCalls + <span class="stringliteral">&quot; draw calls.&quot;</span>);</div><div class="line">}</div></div><!-- fragment --><p>Retrieving the report removes it from the profiler. If more than one report is available then the oldest report is returned first. If you don't retrieve reports for multiple frames the system will start discarding oldest reports. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
