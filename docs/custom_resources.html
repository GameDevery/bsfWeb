<!-- HTML header for doxygen 1.8.10-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>bs::f docs - Creating new resource types</title>
<link rel="icon" type="image/png" href="logo.png">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href='https://fonts.googleapis.com/css?family=Lato:normal,bold|Cabin:normal,bold' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="SemanticUI/semantic.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxystyle.css" rel="stylesheet" type="text/css"/>
<link href="SemanticUI/semantic.css" rel="stylesheet" type="text/css">
</head>
<body>
<div class="everything">
	<div class="ui inverted vertical center aligned segment" id="menuSegment">
		<div class="ui container">
			<div class="ui inverted mainmenu menu">
				<a href="https://www.bsframework.io"><div class="item" id="logoItem"><img class="ui image" id="logo" src="logoHeader.png"></div></a>
				<div class="right menu">
					<a class="borderless item" href="https://www.bsframework.io">Home</a>
					<a class="item" href="https://www.bsframework.io/download.html">Download</a>
					<a class="item" href="https://discourse.bsframework.io">Community</a>
					<a class="active item" href="https://www.bsframework.io/docs/index.html">Documentation</a>
					<a class="item" href="https://github.com/gamefoundry/bsf"><i class="github icon"></i>GitHub</a>
				</div>
			</div>
		</div>
	</div>	
	<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Creating new resource types </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#customResources_a">Custom resource type</a></li>
<li class="level1"><a href="#customResources_b">Custom resource handle</a></li>
<li class="level1"><a href="#customResources_c">Custom resource creation</a></li>
<li class="level1"><a href="#customResources_d">Optional features</a><ul><li class="level2"><a href="#customResources_d_a">Dependencies</a></li>
<li class="level2"><a href="#customResources_d_b">Resource listener</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>Throughout the previous manuals we have shown how to import, load and save a variety of resource types. But you can also add brand new resource types of your own.</p>
<h1><a class="anchor" id="customResources_a"></a>
Custom resource type</h1>
<p>To create a custom resource type you need to implement the <a class="el" href="classbs_1_1_resource.html">Resource</a> interface. <b>Resource</b> derives from both <a class="el" href="classbs_1_1_core_object.html">CoreObject</a> and <a class="el" href="classbs_1_1_i_reflectable.html">IReflectable</a>. These two classes make up majority of its interface, and we have already shown how to implement them in the <a class="el" href="core_thread.html">Core Thread</a> and <a class="el" href="serializing_objects.html">Persisting data</a> manuals.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyResource : <span class="keyword">public</span> Resource</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    MyResource()</div><div class="line">        :Resource(false)</div><div class="line">    { }</div><div class="line"></div><div class="line">    UINT32 someData; <span class="comment">// Fields should be referenced by the RTTI code, so they get saved</span></div><div class="line">    UINT32 moreData; </div><div class="line"></div><div class="line">    <span class="keyword">friend</span> <span class="keyword">class </span>MyResourceRTTI;</div><div class="line">    <span class="keyword">static</span> RTTITypeBase* getRTTIStatic() { <span class="keywordflow">return</span> MyResourceRTTI::instance(); }</div><div class="line">    RTTITypeBase* getRTTI()<span class="keyword"> const override </span>{ <span class="keywordflow">return</span> getRTTIStatic(); }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// MyResourceRTTI implemented as a standard RTTI object, as discussed previously</span></div></div><!-- fragment --><p>The constructor of <b>Resource</b> accepts one parameter, signifying whether or not your resource requires a core-thread representation. If you set this to false then you don't need to implement any of the core thread sync functionality (as described in <a class="el" href="core_thread.html">Core Thread</a> manual), and <a class="el" href="classbs_1_1_core_object.html#a608f8b18e4310fab6879d2c43d6ad8e2">CoreObject::getCore()</a> method will simply return null. In general if your resource doesn't need to be used on the core thread set this to false. On the other hand, if it is used by systems like the renderer or the render API, set it to true.</p>
<h1><a class="anchor" id="customResources_b"></a>
Custom resource handle</h1>
<p>To create a handle for your custom resource, similarly to <b>HTexture</b> or <b>HMesh</b>, simply create a <em>typedef</em> using the <a class="el" href="group___resources.html#ga9725baf9e9bc1d578543a89a7e49cee2">ResourceHandle&lt;T&gt;</a> type. Generally you want to define this in some header included by all files, for convenience.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> ResourceHandle&lt;MyResource&gt; HMyResource;</div></div><!-- fragment --><h1><a class="anchor" id="customResources_c"></a>
Custom resource creation</h1>
<p>When creating a new instance of your resource you need to follow all the rules for <b>CoreObject</b> creation. This will yield you a shared pointer to the resource. To create a handle to the resource you must call <a class="el" href="classbs_1_1_resources.html#ad69a3790b5a118b02dbb41013515b3ef">Resources::_createResourceHandle()</a>. Because of this complex initialization procedure you are encouraged to write a static <b>create()</b> method that handles all of it internally, same as for <b>CoreObject</b>s.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyResource : <span class="keyword">public</span> Resource</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// ... other MyResource code</span></div><div class="line"></div><div class="line">    <span class="keyword">static</span> HMyResource create()</div><div class="line">    {</div><div class="line">        <span class="comment">// Standard core object initialization</span></div><div class="line">        SPtr&lt;MyResource&gt; sptr = bs_core_ptr&lt;MyResource&gt;(bs_new&lt;MyResource&gt;());</div><div class="line">        sptr-&gt;_setThisPtr(sptr);</div><div class="line">        sptr-&gt;initialize();</div><div class="line"></div><div class="line">        <span class="comment">// Create a handle</span></div><div class="line">        <span class="keywordflow">return</span> <a class="code" href="group___resources.html#gaf38f08e12f1845752a5aeb1b268851f3">static_resource_cast</a>&lt;MyResource&gt;(<a class="code" href="group___resources.html#ga9f2bdcc73874df6e64f4c1c72e56ab2a">gResources</a>().<a class="code" href="classbs_1_1_resources.html#ad69a3790b5a118b02dbb41013515b3ef">_createResourceHandle</a>(sptr));</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><h1><a class="anchor" id="customResources_d"></a>
Optional features</h1>
<p>Implementations above represent the minimal set of features to create your own resource, but there are some optional features we'll cover in this section.</p>
<h2><a class="anchor" id="customResources_d_a"></a>
Dependencies</h2>
<p>If your custom resource is dependant on some other resource make sure to implement the <a class="el" href="classbs_1_1_resource.html#a949cdc99147d8447c972b17c616b5ff3">Resource::getResourceDependencies()</a> method which should return a list of all resources it is dependant upon. For example, a <b>Material</b> resource is dependant on the <b>Shader</b> resource, as well as any <b>Texture</b> resources set as its parameters.</p>
<div class="fragment"><div class="line"><span class="comment">// Assuming our MyResource class is dependant on a texture</span></div><div class="line"><span class="keyword">class </span>MyResource : <span class="keyword">public</span> Resource</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// ... other MyResource code</span></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> getResourceDependencies(FrameVector&lt;HResource&gt;&amp; dependencies)<span class="keyword"> const override</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        dependencies.push_back(mSomeTexture);</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    HTexture mSomeTexture;</div><div class="line">};</div></div><!-- fragment --><p>Such dependant resources will be checked when <a class="el" href="classbs_1_1_resource_handle_base.html#a147c4df4a6265b39a86625ba01bf01a5">HResource::isLoaded()</a> or <a class="el" href="classbs_1_1_resource_handle_base.html#a835de42e7481da49e0258c0a5fa9b93c">HResource::blockUntilLoaded()</a> is called with <code>checkDependencies</code> parameter enabled. This ensures you have an easy to way to check if a resource is truly usable (it is loaded, as well as everything it depends on).</p>
<h2><a class="anchor" id="customResources_d_b"></a>
Resource listener</h2>
<p>If an object is interested in learning when a certain resource has been loaded or updated you can implement the <a class="el" href="classbs_1_1_i_resource_listener.html">IResourceListener</a> interface. This interface can be implemented both on resources and on normal objects.</p>
<p>To implement it you must return a list of resource handles you are interested in tracking by implementing the <a class="el" href="classbs_1_1_i_resource_listener.html#a1db7efc56c3d89d5b2f13c8988966be9">IResourceListener::getListenerResources()</a> method. Whenever the dependant resource list changes you should call <a class="el" href="classbs_1_1_i_resource_listener.html#afc67df14a571ddf168963d3592995406">IResourceListener::markListenerResourcesDirty()</a>.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>SomeClass : <span class="keyword">public</span> IResourceListener</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keywordtype">void</span> setTexture(<span class="keyword">const</span> HTexture&amp; tex)</div><div class="line">    {</div><div class="line">        mSomeTexture = tex;</div><div class="line"></div><div class="line">        <span class="comment">// This lets the listener know the list of listener resources changed and a new list needs to be retrieved from getListenerResources()</span></div><div class="line">        markListenerResourcesDirty();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> getListenerResources(Vector&lt;HResource&gt;&amp; resources)</div><div class="line">    {</div><div class="line">        <span class="comment">// Place any resources you are interested in listening for in the &quot;resources&quot; vector</span></div><div class="line">        <span class="keywordflow">if</span> (mSomeTexture != <span class="keyword">nullptr</span>)</div><div class="line">            resources.push_back(mSomeTexture);</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    HTexture mSomeTexture;</div><div class="line">};</div></div><!-- fragment --><p>Whenever a resource you are listening for is loaded <a class="el" href="classbs_1_1_i_resource_listener.html#aec9b9f6414be5ffa0c971963d5d4b78f">IResourceListener::notifyResourceLoaded()</a> will be called. Similarly whenever a resource is re-imported <a class="el" href="classbs_1_1_i_resource_listener.html#a75b50f7e3509b804ff4ca5ec80579cc0">IResourceListener::notifyResourceChanged()</a> will be called.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>SomeClass : <span class="keyword">public</span> IResourceListener</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// ... other SomeClass code</span></div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> notifyResourceLoaded(<span class="keyword">const</span> HResource&amp; resource)</div><div class="line">    {</div><div class="line">        <span class="comment">// &quot;resource&quot; could be an asynchronously loaded resource, and we wait on initialization of this object until it is loaded</span></div><div class="line">        initialize();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> notifyResourceChanged(<span class="keyword">const</span> HResource&amp; resource)</div><div class="line">    {</div><div class="line">        <span class="comment">// User could have triggered a reimport for the resource in which case we might need to do some form of re-initialization.</span></div><div class="line">        <span class="comment">// This is especially useful for resource hot-swap, where user can just reimport a resource with new data and the system</span></div><div class="line">        <span class="comment">// automatically starts using a new resource throughout the application.</span></div><div class="line">        reinitialize();</div><div class="line">    }</div><div class="line">};</div></div><!-- fragment --><p><b>IResourceListener::notifyResourceLoaded()</b> triggers when a resource is loaded in response to a <a class="el" href="classbs_1_1_resources.html#a267a91924db1c2fbaef8da0dd760655e">Resources::load()</a> or <a class="el" href="classbs_1_1_resources.html#aa383dd3e3d6234b08d760c89c3a42380">Resources::loadAsync()</a> call.</p>
<p><b>IResourceListener::notifyResourceChanged()</b> triggers whenever user calls <a class="el" href="classbs_1_1_resources.html#a81f51d93b4b9db43e586cc04ae0275f3">Resources::update()</a>. This method will update the contents of a resource handle with new resource data, and trigger any listeners.</p>
<p><b>Resources</b> module also provides <a class="el" href="classbs_1_1_resources.html#a2b93aff01c0edb168a59cfe2cbf1d466">Resources::onResourceLoaded</a>, <a class="el" href="classbs_1_1_resources.html#a1e3b32eddadb3ef2f35abc8afee949be">Resources::onResourceDestroyed</a> and <a class="el" href="classbs_1_1_resources.html#a61e9d76b7ce91cffe7b3c88575ae3021">Resources::onResourceModified</a> events which may be used for a similar purpose, but <b>IResourceListener</b> is more efficient since it only tracks specific resources, while these events trigger for every resource. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.10-->
<!-- start footer part -->
    <!-- Footer -->
    <div class="myFooter">
		<div class="ui inverted vertical footer segment" style="border-top: 2px solid #f9500d;">
			<div class="ui container">
				<div class="ui stackable inverted divided equal height grid">
					<div class="three wide column">
						<h4 class="ui inverted header">Contact</h4>
						<div class="ui inverted link list">
							<a href="mailto:contact@bsframework.io" class="item">Contact us</a>
							<a href="https://github.com/GameFoundry/bsf/issues" target="_blank" class="item">Report an issue</a>
						</div>
					</div>
					<div class="three wide column">
						<h4 class="ui inverted header">Info</h4>
						<div class="ui inverted link list">
							<a href="https://github.com/GameFoundry/bsf" target="_blank" class="item">Contribute</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/Documentation/GitHub/roadmap.md" target="_blank" class="item">Roadmap</a>
							<a href="https://github.com/GameFoundry/bsf/blob/master/LICENSE.md" target="_blank" class="item">License</a>
						</div>
					</div>
					<div class="seven wide column">
						<h4 class="ui inverted header">Donate</h4>
						<div class="ui horizontal list">
							<div class="item"><a href="https://www.patreon.com/bsf"><img class="ui image" src="become_a_patron_button.png"></a></div>
							<div class="item"><a href="https://www.paypal.me/MarkoPintera/10" target="_blank"><img class="ui image" src="paypalDonate.png"></a></div>
						</div>
						<p style="padding-top:7px"><i>bs::f</i> is developed by Marko Pintera and contributors.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div> <!-- Everything -->
</body>
</html>
